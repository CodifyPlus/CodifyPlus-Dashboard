(()=>{var e={470:function(e,t,i){var n;n=function(){var e=!0;function t(t){function i(e){var i=t.match(e);return i&&i.length>1&&i[1]||""}var n,o,s,r=i(/(ipod|iphone|ipad)/i).toLowerCase(),a=!/like android/i.test(t)&&/android/i.test(t),c=/nexus\s*[0-6]\s*/i.test(t),d=!c&&/nexus\s*[0-9]+/i.test(t),u=/CrOS/.test(t),l=/silk/i.test(t),g=/sailfish/i.test(t),p=/tizen/i.test(t),f=/(web|hpw)os/i.test(t),h=/windows phone/i.test(t),v=(/SamsungBrowser/i.test(t),!h&&/windows/i.test(t)),m=!r&&!l&&/macintosh/i.test(t),b=!a&&!g&&!p&&!f&&/linux/i.test(t),S=i(/edge\/(\d+(\.\d+)?)/i),y=i(/version\/(\d+(\.\d+)?)/i),w=/tablet/i.test(t)&&!/tablet pc/i.test(t),O=!w&&/[^-]mobi/i.test(t),I=/xbox/i.test(t);/opera/i.test(t)?n={name:"Opera",opera:e,version:y||i(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(t)?n={name:"Opera",opera:e,version:i(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||y}:/SamsungBrowser/i.test(t)?n={name:"Samsung Internet for Android",samsungBrowser:e,version:y||i(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(t)?n={name:"Opera Coast",coast:e,version:y||i(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(t)?n={name:"Yandex Browser",yandexbrowser:e,version:y||i(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(t)?n={name:"UC Browser",ucbrowser:e,version:i(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(t)?n={name:"Maxthon",maxthon:e,version:i(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(t)?n={name:"Epiphany",epiphany:e,version:i(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(t)?n={name:"Puffin",puffin:e,version:i(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(t)?n={name:"Sleipnir",sleipnir:e,version:i(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(t)?n={name:"K-Meleon",kMeleon:e,version:i(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:h?(n={name:"Windows Phone",windowsphone:e},S?(n.msedge=e,n.version=S):(n.msie=e,n.version=i(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(t)?n={name:"Internet Explorer",msie:e,version:i(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:u?n={name:"Chrome",chromeos:e,chromeBook:e,chrome:e,version:i(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(t)?n={name:"Microsoft Edge",msedge:e,version:S}:/vivaldi/i.test(t)?n={name:"Vivaldi",vivaldi:e,version:i(/vivaldi\/(\d+(\.\d+)?)/i)||y}:g?n={name:"Sailfish",sailfish:e,version:i(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?n={name:"SeaMonkey",seamonkey:e,version:i(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(t)?(n={name:"Firefox",firefox:e,version:i(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(n.firefoxos=e)):l?n={name:"Amazon Silk",silk:e,version:i(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(t)?n={name:"PhantomJS",phantom:e,version:i(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(t)?n={name:"SlimerJS",slimer:e,version:i(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?n={name:"BlackBerry",blackberry:e,version:y||i(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:f?(n={name:"WebOS",webos:e,version:y||i(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(n.touchpad=e)):/bada/i.test(t)?n={name:"Bada",bada:e,version:i(/dolfin\/(\d+(\.\d+)?)/i)}:p?n={name:"Tizen",tizen:e,version:i(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||y}:/qupzilla/i.test(t)?n={name:"QupZilla",qupzilla:e,version:i(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||y}:/chromium/i.test(t)?n={name:"Chromium",chromium:e,version:i(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||y}:/chrome|crios|crmo/i.test(t)?n={name:"Chrome",chrome:e,version:i(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:a?n={name:"Android",version:y}:/safari|applewebkit/i.test(t)?(n={name:"Safari",safari:e},y&&(n.version=y)):r?(n={name:"iphone"==r?"iPhone":"ipad"==r?"iPad":"iPod"},y&&(n.version=y)):n=/googlebot/i.test(t)?{name:"Googlebot",googlebot:e,version:i(/googlebot\/(\d+(\.\d+))/i)||y}:{name:i(/^(.*)\/(.*) /),version:(o=/^(.*)\/(.*) /,s=t.match(o),s&&s.length>1&&s[2]||"")},!n.msedge&&/(apple)?webkit/i.test(t)?(/(apple)?webkit\/537\.36/i.test(t)?(n.name=n.name||"Blink",n.blink=e):(n.name=n.name||"Webkit",n.webkit=e),!n.version&&y&&(n.version=y)):!n.opera&&/gecko\//i.test(t)&&(n.name=n.name||"Gecko",n.gecko=e,n.version=n.version||i(/gecko\/(\d+(\.\d+)?)/i)),n.windowsphone||n.msedge||!a&&!n.silk?n.windowsphone||n.msedge||!r?m?n.mac=e:I?n.xbox=e:v?n.windows=e:b&&(n.linux=e):(n[r]=e,n.ios=e):n.android=e;var P="";n.windows?P=function(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}(i(/Windows ((NT|XP)( \d\d?.\d)?)/i)):n.windowsphone?P=i(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):n.mac?P=(P=i(/Mac OS X (\d+([_\.\s]\d+)*)/i)).replace(/[_\s]/g,"."):r?P=(P=i(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):a?P=i(/android[ \/-](\d+(\.\d+)*)/i):n.webos?P=i(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):n.blackberry?P=i(/rim\stablet\sos\s(\d+(\.\d+)*)/i):n.bada?P=i(/bada\/(\d+(\.\d+)*)/i):n.tizen&&(P=i(/tizen[\/\s](\d+(\.\d+)*)/i)),P&&(n.osversion=P);var k=!n.windows&&P.split(".")[0];return w||d||"ipad"==r||a&&(3==k||k>=4&&!O)||n.silk?n.tablet=e:(O||"iphone"==r||"ipod"==r||a||c||n.blackberry||n.webos||n.bada)&&(n.mobile=e),n.msedge||n.msie&&n.version>=10||n.yandexbrowser&&n.version>=15||n.vivaldi&&n.version>=1||n.chrome&&n.version>=20||n.samsungBrowser&&n.version>=4||n.firefox&&n.version>=20||n.safari&&n.version>=6||n.opera&&n.version>=10||n.ios&&n.osversion&&n.osversion.split(".")[0]>=6||n.blackberry&&n.version>=10.1||n.chromium&&n.version>=20?n.a=e:n.msie&&n.version<10||n.chrome&&n.version<20||n.firefox&&n.version<20||n.safari&&n.version<6||n.opera&&n.version<10||n.ios&&n.osversion&&n.osversion.split(".")[0]<6||n.chromium&&n.version<20?n.c=e:n.x=e,n}var i=t("undefined"!=typeof navigator&&navigator.userAgent||"");function n(e){return e.split(".").length}function o(e,t){var i,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(i=0;i<e.length;i++)n.push(t(e[i]));return n}function s(e){for(var t=Math.max(n(e[0]),n(e[1])),i=o(e,(function(e){var i=t-n(e);return o((e+=new Array(i+1).join(".0")).split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));--t>=0;){if(i[0][t]>i[1][t])return 1;if(i[0][t]!==i[1][t])return-1;if(0===t)return 0}}function r(e,n,o){var r=i;"string"==typeof n&&(o=n,n=void 0),void 0===n&&(n=!1),o&&(r=t(o));var a=""+r.version;for(var c in e)if(e.hasOwnProperty(c)&&r[c]){if("string"!=typeof e[c])throw new Error("Browser version in the minVersion map should be a string: "+c+": "+String(e));return s([a,e[c]])<0}return n}return i.test=function(e){for(var t=0;t<e.length;++t){var n=e[t];if("string"==typeof n&&n in i)return!0}return!1},i.isUnsupportedBrowser=r,i.compareVersions=s,i.check=function(e,t,i){return!r(e,t,i)},i._detect=t,i},e.exports?e.exports=n():i.amdD("bowser",n)}},t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,i),s.exports}i.amdD=function(){throw new Error("define cannot be used indirect")},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";function e(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}c((n=n.apply(e,t||[])).next())}))}Object.create;var t,n,o,s,r;Object.create;!function(e){e.Development="Development",e.Staging="Staging",e.Production="Production"}(t||(t={})),function(e){e.None="None",e.UnitTesting="Unit Testing"}(n||(n={})),function(e){e.ServiceWorker="ServiceWorker",e.Host="Host",e.OneSignalSubscriptionPopup="Popup",e.OneSignalSubscriptionModal="Modal",e.OneSignalProxyFrame="ProxyFrame",e.CustomIframe="CustomFrame",e.Unknown="Unknown"}(o||(o={}));class a extends Error{constructor(e=""){super(e),Object.defineProperty(this,"message",{configurable:!0,enumerable:!1,value:e,writable:!0}),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:this.constructor.name,writable:!0}),Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,this.constructor):(Object.defineProperty(this,"stack",{configurable:!0,enumerable:!1,value:new Error(e).stack,writable:!0}),Object.setPrototypeOf(this,a.prototype))}}!function(e){e[e.Empty=0]="Empty",e[e.Malformed=1]="Malformed",e[e.EnumOutOfRange=2]="EnumOutOfRange",e[e.WrongType=3]="WrongType"}(s||(s={}));class InvalidArgumentError extends a{constructor(e,t,i){let n;switch(t){case s.Empty:n=`Supply a non-empty value to '${e}'. ${i}`;break;case s.Malformed:n=`The value for '${e}' was malformed. ${i}`;break;case s.EnumOutOfRange:n=`The value for '${e}' was out of range of the expected input enum. ${i}`;break;case s.WrongType:n=`The value for '${e}' was of the wrong type. ${i}`}super(n),this.argument=e,this.reason=s[t],Object.setPrototypeOf(this,InvalidArgumentError.prototype)}}!function(e){e.Secure="Secure",e.SecureProxy="Secure Proxy",e.InsecureProxy="Insecure Proxy"}(r||(r={}));var c,d=i(470),u=i.n(d);!function(e){e[e.MissingAppId=0]="MissingAppId",e[e.RetryLimitReached=1]="RetryLimitReached"}(c||(c={}));class l extends a{constructor(e){let t;switch(e){case c.MissingAppId:t="The API call is missing an app ID.";break;case c.RetryLimitReached:t="The API call has reached the retry limit."}super(t),Object.setPrototypeOf(this,l.prototype)}}class TimeoutError extends a{constructor(e="The asynchronous operation has timed out."){super(e),this.message=e,Object.setPrototypeOf(this,TimeoutError.prototype)}}class g{static contains(e,t){return!!e&&-1!==e.indexOf(t)}static trimUndefined(e){for(const t in e)void 0===e[t]&&delete e[t];return e}static capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}static isNullOrUndefined(e){return null==e}static valueOrDefault(e,t){return null==e?t:e}static stringify(e){return JSON.stringify(e,((e,t)=>"function"==typeof t?"[Function]":t),4)}static encodeHashAsUriComponent(e){let t="";const i=Object.keys(e);for(const n of i){const i=e[n];t+=`${encodeURIComponent(n)}=${encodeURIComponent(i)}`}return t}static timeoutPromise(e,t){const i=new Promise(((e,i)=>{setTimeout((()=>{i(new TimeoutError)}),t)}));return Promise.race([e,i])}static getValueOrDefault(e,t){return null!=e?e:t}static padStart(e,t,i){let n=e;for(;n.length<t;)n=i+n;return n}static parseVersionString(e){const t=e.toString().split("."),i=g.padStart(t[0],2,"0");let n;return n=t[1]?g.padStart(t[1],2,"0"):"00",Number(`${i}.${n}`)}static lastParts(e,t,i){const n=e.split(t),o=Math.max(n.length-i,0);return n.slice(o).join(t)}static enforceAppId(e){if(!e)throw new Error("App id cannot be empty")}static enforcePlayerId(e){if(!e)throw new Error("Player id cannot be empty")}static enforceAlias(e){if(!e.label)throw new Error("Alias label cannot be empty");if(!e.id)throw new Error("Alias id cannot be empty")}static enforceAppIdAndPlayerId(t,i,n){return e(this,void 0,void 0,(function*(){g.enforceAppId(t),g.enforcePlayerId(i);try{return yield n()}catch(e){throw e&&Array.isArray(e.errors)&&e.errors.length>0&&g.contains(e.errors[0],"app_id not found")?new l(c.MissingAppId):e}}))}static sortArrayOfObjects(e,t,i=!1,n=!0){const o=n?e:e.slice();return o.sort(((e,n)=>{const o=t(e),s=t(n);return o>s?i?-1:1:o<s?i?1:-1:0})),o}}const p=g;class f{static shouldLog(){try{if("undefined"==typeof window||void 0===window.localStorage)return!1;const e=window.localStorage.getItem("loglevel");return!(!e||"trace"!==e.toLowerCase())}catch(e){return!1}}static setLevel(e){if("undefined"!=typeof window&&void 0!==window.localStorage)try{window.localStorage.setItem("loglevel",e),f.proxyMethodsCreated=void 0,f.createProxyMethods()}catch(e){return}}static createProxyMethods(){if(void 0!==f.proxyMethodsCreated)return;f.proxyMethodsCreated=!0;const e={log:"debug",trace:"trace",info:"info",warn:"warn",error:"error"};for(const t of Object.keys(e)){const i=void 0!==console[t],n=e[t],o=i&&(f.shouldLog()||"error"===n);f[n]=o?console[t].bind(console):function(){}}}}function h(){return{mobile:d.mobile,tablet:d.tablet,name:d.name.toLowerCase(),version:d.version}}f.createProxyMethods();class v{static getBaseUrl(){return location.origin}static isLocalhostAllowedAsSecureOrigin(){return OneSignal.config&&OneSignal.config.userConfig&&!0===OneSignal.config.userConfig.allowLocalhostAsSecureOrigin}static isUsingSubscriptionWorkaround(){const e=S.getWindowEnv();if(!OneSignal.config)throw new Error(`(${e.toString()}) isUsingSubscriptionWorkaround() cannot be called until OneSignal.config exists.`);if("safari"==h().name)return!1;const t=this.isLocalhostAllowedAsSecureOrigin();return v.internalIsUsingSubscriptionWorkaround(OneSignal.config.subdomain,t)}static internalIsUsingSubscriptionWorkaround(e,t){if("safari"==h().name)return!1;if(!0===t&&("localhost"===location.hostname||"127.0.0.1"===location.hostname))return!1;const i=S.getWindowEnv(),n="http:"===location.protocol;if((i===o.Host||i===o.CustomIframe)&&(!!e||n))throw n?new Error("OneSignalSDK: HTTP sites are no longer supported starting with version 16 (User Model), your public site must start with https://. Please visit the OneSignal dashboard's Settings > Web Configuration to find this option."):new Error('OneSignalSDK: The "My site is not fully HTTPS" option is no longer supported starting with version 16 (User Model) of the OneSignal SDK. Please visit the OneSignal dashboard\'s Settings > Web Configuration to find this option.');return!1}static redetectBrowserUserAgent(){return""===h().name&&""===h().version?u()._detect(navigator.userAgent):u()}static isValidUuid(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/.test(e)}static getRandomUuid(){const e="undefined"==typeof window?i.g.crypto:window.crypto||window.msCrypto;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const i=e.getRandomValues(new Uint8Array(1))[0]%16|0;return("x"==t?i:3&i|8).toString(16)}))}static logMethodCall(e,...t){return f.debug(`Called ${e}(${t.map(g.stringify).join(", ")})`)}static isHttps(){return v.isSafari()?"https:"===window.location.protocol:!v.isUsingSubscriptionWorkaround()}static isSafari(){return I.isBrowser()&&void 0!==window.safari}}const m=v,b=["outcomes","on_focus"];class S{static getBuildEnv(){return t.Production}static getApiEnv(){return t.Production}static getIntegration(t){return e(this,void 0,void 0,(function*(){if(I.useSafariLegacyPush())return r.Secure;const e=window===window.top,i="https:"===window.location.protocol;if(void 0===t){if("undefined"==typeof OneSignal||!OneSignal.context||!OneSignal.context.appConfig)throw new InvalidArgumentError("usingProxyOrigin",s.Empty);t=!!OneSignal.context.appConfig.subdomain}if(e)return i?t?r.SecureProxy:r.Secure:!m.isLocalhostAllowedAsSecureOrigin()||"localhost"!==location.hostname&&"127.0.0.1"!==location.hostname?r.InsecureProxy:r.Secure;if(i){return(yield S.isFrameContextInsecure())?r.InsecureProxy:t?r.SecureProxy:r.Secure}return r.InsecureProxy}))}static isFrameContextInsecure(){return e(this,void 0,void 0,(function*(){if(window===window.top||!("serviceWorker"in navigator)||void 0===navigator.serviceWorker.getRegistration)return!1;return!(yield OneSignal.context.serviceWorkerManager.getRegistration())}))}static isInsecureOrigin(){return"http:"===window.location.protocol}static getOrigin(){return I.isBrowser()?window.location.origin:"undefined"!=typeof self&&"undefined"!=typeof ServiceWorkerGlobalScope?self.location.origin:"Unknown"}static getWindowEnv(){return"undefined"==typeof window?"undefined"!=typeof self&&"undefined"!=typeof ServiceWorkerGlobalScope?o.ServiceWorker:o.Unknown:window===window.top?-1!==location.href.indexOf("initOneSignal")||"/subscribe"===location.pathname&&""===location.search&&(location.hostname.endsWith(".onesignal.com")||location.hostname.endsWith(".os.tc")||-1!==location.hostname.indexOf(".localhost")&&S.getBuildEnv()===t.Development)?o.OneSignalSubscriptionPopup:o.Host:"/webPushIframe"===location.pathname?o.OneSignalProxyFrame:"/webPushModal"===location.pathname?o.OneSignalSubscriptionModal:o.CustomIframe}static getTestEnv(){return n.None}static getBuildEnvPrefix(e=S.getBuildEnv()){switch(e){case t.Development:return"Dev-";case t.Staging:return"Staging-";case t.Production:return"";default:throw new InvalidArgumentError("buildEnv",s.EnumOutOfRange)}}static getOneSignalApiUrl(e=S.getApiEnv(),i){const n="localhost";switch(e){case t.Development:return S.isTurbineEndpoint(i)?new URL(`https://${n}:18080/api/v1`):new URL(`https://${n}:3001/api/v1`);case t.Staging:return new URL(`https://${n}/api/v1`);case t.Production:return new URL("https://onesignal.com/api/v1");default:throw new InvalidArgumentError("buildEnv",s.EnumOutOfRange)}}static getOneSignalStaticResourcesUrl(){return new URL("https://media.onesignal.com/web-sdk")}static getOneSignalResourceUrlPath(e=S.getBuildEnv()){const i="localhost";let n;switch(e){case t.Development:n=`http://${i}:4000`;break;case t.Staging:n=`https://${i}`;break;case t.Production:n="https://onesignal.com";break;default:throw new InvalidArgumentError("buildEnv",s.EnumOutOfRange)}return new URL(`${n}/sdks/web/v16`)}static getOneSignalCssFileName(e=S.getBuildEnv()){const i="OneSignalSDK.page.styles.css";switch(e){case t.Development:return`Dev-${i}`;case t.Staging:return`Staging-${i}`;case t.Production:return i;default:throw new InvalidArgumentError("buildEnv",s.EnumOutOfRange)}}static isTurbineEndpoint(e){return!!e&&b.some((t=>e.indexOf(t)>-1))}}function y(){return window.top!==window&&O()&&"MacIntel"===navigator.platform}function w(){return"undefined"!=typeof PushSubscriptionOptions&&PushSubscriptionOptions.prototype.hasOwnProperty("applicationServerKey")}function O(){return"Apple Computer, Inc."===navigator.vendor}class I{static isBrowser(){return"undefined"!=typeof window}static useSafariLegacyPush(){var e;return this.isBrowser()&&null!=(null===(e=window.safari)||void 0===e?void 0:e.pushNotification)}static useSafariVapidPush(){return"safari"==h().name&&w()&&!this.useSafariLegacyPush()}static version(){return Number(160100)}static get TRADITIONAL_CHINESE_LANGUAGE_TAG(){return["tw","hant"]}static get SIMPLIFIED_CHINESE_LANGUAGE_TAG(){return["cn","hans"]}static getLanguage(){let e=navigator.language;if(e){e=e.toLowerCase();const t=e.split("-");if("zh"==t[0]){for(const e of I.TRADITIONAL_CHINESE_LANGUAGE_TAG)if(-1!==t.indexOf(e))return"zh-Hant";for(const e of I.SIMPLIFIED_CHINESE_LANGUAGE_TAG)if(-1!==t.indexOf(e))return"zh-Hans";return"zh-Hant"}return t[0].substring(0,2)}return"en"}static supportsServiceWorkers(){return S.getWindowEnv()===o.ServiceWorker||"undefined"!=typeof navigator&&"serviceWorker"in navigator}static getSdkStylesVersionHash(){return"undefined"==typeof __SRC_STYLESHEETS_MD5_HASH__?"2":__SRC_STYLESHEETS_MD5_HASH__}}class P{static getRegistration(t){return e(this,void 0,void 0,(function*(){try{const e=location.origin+t;return yield navigator.serviceWorker.getRegistration(e)}catch(e){return f.warn("[Service Worker Status] Error Checking service worker registration",t,e),null}}))}static getAvailableServiceWorker(e){const t=e.active||e.installing||e.waiting;return t||f.warn("Could not find an available ServiceWorker instance!"),t}static waitUntilActive(e){return new Promise((t=>{const i=e.installing||e.waiting;i&&i.addEventListener("statechange",(()=>{f.debug("OneSignal Service Worker state changed:",i.state),e.active&&t()})),e.active&&t()}))}}var k,x;!function(e){e.WorkerVersion="GetWorkerVersion",e.Subscribe="Subscribe",e.SubscribeNew="SubscribeNew",e.AmpSubscriptionState="amp-web-push-subscription-state",e.AmpSubscribe="amp-web-push-subscribe",e.AmpUnsubscribe="amp-web-push-unsubscribe",e.NotificationWillDisplay="notification.willDisplay",e.NotificationClicked="notification.clicked",e.NotificationDismissed="notification.dismissed",e.RedirectPage="command.redirect",e.SessionUpsert="os.session.upsert",e.SessionDeactivate="os.session.deactivate",e.AreYouVisible="os.page_focused_request",e.AreYouVisibleResponse="os.page_focused_response",e.SetLogging="os.set_sw_logging"}(k||(k={}));class E{constructor(){this.replies={}}addListener(e,t,i){const n={callback:t,onceListenerOnly:i},o=this.replies[e.toString()];o?o.push(n):this.replies[e.toString()]=[n]}findListenersForMessage(e){return this.replies[e.toString()]||[]}deleteListenerRecords(e){this.replies[e.toString()]=null}deleteAllListenerRecords(){this.replies={}}deleteListenerRecord(e,t){const i=this.replies[e.toString()];if(null!=i)for(let e=i.length-1;e>=0;e--){i[e]===t&&i.splice(e,1)}}}class C{constructor(e,t=new E){this.context=e,this.replies=t}broadcast(t,i){return e(this,void 0,void 0,(function*(){if(S.getWindowEnv()!==o.ServiceWorker)return;const e=yield self.clients.matchAll({type:"window",includeUncontrolled:!0});for(const n of e)f.debug(`[Worker Messenger] [SW -> Page] Broadcasting '${t.toString()}' to window client ${n.url}.`),n.postMessage({command:t,payload:i})}))}unicast(t,i,n){return e(this,void 0,void 0,(function*(){if(S.getWindowEnv()===o.ServiceWorker){if(!n)throw new InvalidArgumentError("windowClient",s.Empty);f.debug(`[Worker Messenger] [SW -> Page] Unicasting '${t.toString()}' to window client ${n.url}.`),n.postMessage({command:t,payload:i})}else f.debug(`[Worker Messenger] [Page -> SW] Unicasting '${t.toString()}' to service worker.`),this.directPostMessageToSW(t,i)}))}directPostMessageToSW(t,i){return e(this,void 0,void 0,(function*(){var e;f.debug(`[Worker Messenger] [Page -> SW] Direct command '${t.toString()}' to service worker.`);const n=yield null===(e=this.context)||void 0===e?void 0:e.serviceWorkerManager.getRegistration();if(!n)return void f.error("`[Worker Messenger] [Page -> SW] Could not get ServiceWorkerRegistration to postMessage!");const o=P.getAvailableServiceWorker(n);o?o.postMessage({command:t,payload:i}):f.error("`[Worker Messenger] [Page -> SW] Could not get ServiceWorker to postMessage!")}))}listen(){return e(this,void 0,void 0,(function*(){if(!I.supportsServiceWorkers())return;S.getWindowEnv()===o.ServiceWorker?(self.addEventListener("message",this.onWorkerMessageReceivedFromPage.bind(this)),f.debug("[Worker Messenger] Service worker is now listening for messages.")):yield this.listenForPage()}))}listenForPage(){return e(this,void 0,void 0,(function*(){navigator.serviceWorker.addEventListener("message",this.onPageMessageReceivedFromServiceWorker.bind(this)),f.debug(`(${location.origin}) [Worker Messenger] Page is now listening for messages.`)}))}onWorkerMessageReceivedFromPage(e){const t=e.data;if(!t||!t.command)return;const i=this.replies.findListenersForMessage(t.command),n=[],o=[];f.debug("[Worker Messenger] Service worker received message:",e.data);for(const e of i)e.onceListenerOnly&&n.push(e),o.push(e);for(let e=n.length-1;e>=0;e--){const i=n[e];this.replies.deleteListenerRecord(t.command,i)}for(const e of o)e.callback.apply(null,[t.payload])}onPageMessageReceivedFromServiceWorker(e){const t=e.data;if(!t||!t.command)return;const i=this.replies.findListenersForMessage(t.command),n=[],o=[];f.debug("[Worker Messenger] Page received message:",e.data);for(const e of i)e.onceListenerOnly&&n.push(e),o.push(e);for(let e=n.length-1;e>=0;e--){const i=n[e];this.replies.deleteListenerRecord(t.command,i)}for(const e of o)e.callback.apply(null,[t.payload])}on(e,t){this.replies.addListener(e,t,!1)}once(e,t){this.replies.addListener(e,t,!0)}off(e){e?this.replies.deleteListenerRecords(e):this.replies.deleteAllListenerRecords()}}!function(e){e.Default="default",e.Granted="granted",e.Denied="denied"}(x||(x={}));class N{static get STORED_PERMISSION_KEY(){return"storedNotificationPermission"}getPermissionStatus(){return e(this,void 0,void 0,(function*(){if(!OneSignal.context)throw new a("OneSignal.context is undefined. Make sure to call OneSignal.init() before calling getPermissionStatus().");return yield OneSignal.context.permissionManager.getNotificationPermission(OneSignal.config.safariWebId)}))}getNotificationPermission(t){return e(this,void 0,void 0,(function*(){const e=yield this.getReportedNotificationPermission(t);return(yield this.isPermissionEnvironmentAmbiguous(e))?yield this.getInterpretedAmbiguousPermission(e):e}))}getReportedNotificationPermission(t){return e(this,void 0,void 0,(function*(){if(I.useSafariLegacyPush())return N.getSafariNotificationPermission(t);if(m.isUsingSubscriptionWorkaround())return yield this.getOneSignalSubdomainNotificationPermission(t);{const e=this.getW3cNotificationPermission();return(yield this.isPermissionEnvironmentAmbiguous(e))?yield this.getInterpretedAmbiguousPermission(e):this.getW3cNotificationPermission()}}))}static getSafariNotificationPermission(e){if(e)return window.safari.pushNotification.permission(e).permission;throw new InvalidArgumentError("safariWebId",s.Empty)}getW3cNotificationPermission(){return Notification.permission}getOneSignalSubdomainNotificationPermission(t){return e(this,void 0,void 0,(function*(){return new Promise((e=>{OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.REMOTE_NOTIFICATION_PERMISSION,{safariWebId:t},(t=>{const i=t.data;e(i)}))}))}))}isPermissionEnvironmentAmbiguous(t){return e(this,void 0,void 0,(function*(){const e=m.redetectBrowserUserAgent();return!e.safari&&!e.firefox&&t===x.Denied&&(this.isCurrentFrameContextCrossOrigin()||(yield S.isFrameContextInsecure())||m.isUsingSubscriptionWorkaround())}))}isCurrentFrameContextCrossOrigin(){let e;try{e=window.top.location.origin}catch(e){return!0}return window.top!==window&&e!==window.location.origin}getInterpretedAmbiguousPermission(t){return e(this,void 0,void 0,(function*(){if(t===x.Denied){const e=this.getStoredPermission();return e||x.Default}return t}))}getStoredPermission(){return M.getStoredPermission()}setStoredPermission(e){M.setStoredPermission(e)}updateStoredPermission(){return e(this,void 0,void 0,(function*(){const e=yield this.getNotificationPermission();return this.setStoredPermission(e)}))}}const A="os_pageViews",T="requiresPrivacyConsent";class M{static removeLegacySubscriptionOptions(){localStorage.removeItem("isOptedOut"),localStorage.removeItem("isPushNotificationsEnabled")}static setConsentRequired(e){localStorage.setItem(T,e.toString())}static getConsentRequired(){return"true"===localStorage.getItem(T)}static setStoredPermission(e){localStorage.setItem(N.STORED_PERMISSION_KEY,e)}static getStoredPermission(){switch(localStorage.getItem(N.STORED_PERMISSION_KEY)||"default"){case"granted":return x.Granted;case"denied":return x.Denied;default:return x.Default}}static setLocalPageViewCount(e){localStorage.setItem(A,e.toString())}static getLocalPageViewCount(){return Number(localStorage.getItem(A))}}class D{constructor(){this.incrementedPageViewCount=!1}getPageViewCount(){try{const e=sessionStorage.getItem(D.SESSION_STORAGE_KEY_NAME),t=e?parseInt(e):0;return isNaN(t)?0:t}catch(e){return 0}}setPageViewCount(e){try{sessionStorage.setItem(D.SESSION_STORAGE_KEY_NAME,e.toString()),S.getWindowEnv()===o.OneSignalSubscriptionPopup&&OneSignal.subscriptionPopup&&OneSignal.subscriptionPopup.message(OneSignal.POSTMAM_COMMANDS.SET_SESSION_COUNT)}catch(e){}}incrementPageViewCount(){if(this.incrementedPageViewCount)return;const e=this.getPageViewCount()+1,t=this.getLocalPageViewCount()+1;this.setPageViewCount(e),this.setLocalPageViewCount(t),this.incrementedPageViewCount=!0,f.debug(`Incremented page view count: newCountSingleTab: ${e},\n      newCountAccrossTabs: ${t}.`)}simulatePageNavigationOrRefresh(){this.incrementedPageViewCount=!1}isFirstPageView(){return 1===this.getPageViewCount()}getLocalPageViewCount(){return M.getLocalPageViewCount()}setLocalPageViewCount(e){M.setLocalPageViewCount(e)}}D.SESSION_STORAGE_KEY_NAME="onesignal-pageview-count";class U{constructor(e){if(!e)throw new InvalidArgumentError("path",s.Empty);this.path=e.trim()}getQueryString(){const e=this.path.indexOf("?");return-1===e?null:this.path.length>e?this.path.substring(e+1):null}getWithoutQueryString(){return this.path.split(U.QUERY_STRING)[0]}getFileName(){var e;return null===(e=this.getWithoutQueryString().split("\\").pop())||void 0===e?void 0:e.split("/").pop()}getFileNameWithQuery(){var e;return null===(e=this.path.split("\\").pop())||void 0===e?void 0:e.split("/").pop()}getFullPath(){return this.path}getPathWithoutFileName(){const e=this.getWithoutQueryString(),t=e.lastIndexOf(this.getFileName());let i=e.substring(0,t);return i=i.replace(/[\\/]$/,""),i}}U.QUERY_STRING="?";class W{constructor(){this._events={}}on(e,t){return this._events[e]=this._events[e]||[],this._events[e].push(t),this}once(e,t){const i=this;function n(){i.off(e,n),t.apply(this,arguments)}return n.listener=t,this.on(e,n),this}off(e,t){const i=this._events[e];if(void 0!==i){for(let e=0;e<i.length;e+=1)if(i[e]===t||i[e].listener===t){i.splice(e,1);break}0===i.length&&this.removeAllListeners(e)}return this}removeAllListeners(e){return e?delete this._events[e]:this._events={},this}listeners(e){try{return this._events[e]}catch(e){return}}numberOfListeners(e){const t=this.listeners(e);return t?t.length:0}emit(...t){return e(this,void 0,void 0,(function*(){const e=t.shift();let i=this._events[e];if(void 0!==i){i=i.slice(0);const e=i.length;for(let n=0;n<e;n+=1)yield i[n].apply(this,t)}return this}))}}var _;!function(e){e.Identity="identity",e.Properties="properties",e.PushSubscriptions="pushSubscriptions",e.EmailSubscriptions="emailSubscriptions",e.SmsSubscriptions="smsSubscriptions"}(_||(_={}));class R{constructor(e,t=5){this.databaseName=e,this.dbVersion=t,this.emitter=new W}open(e){return new Promise((t=>{let i;try{i=indexedDB.open(e,this.dbVersion)}catch(e){}if(!i)return null;i.onerror=this.onDatabaseOpenError.bind(this),i.onblocked=this.onDatabaseOpenBlocked.bind(this),i.onupgradeneeded=this.onDatabaseUpgradeNeeded.bind(this),i.onsuccess=()=>{this.database=i.result,this.database.onerror=this.onDatabaseError,this.database.onversionchange=this.onDatabaseVersionChange,t(this.database)}}))}close(){return e(this,void 0,void 0,(function*(){var e;(yield this.ensureDatabaseOpen()).close(),null===(e=this.database)||void 0===e||e.close()}))}ensureDatabaseOpen(){return e(this,void 0,void 0,(function*(){return this.openLock||(this.openLock=this.open(this.databaseName)),yield this.openLock}))}onDatabaseOpenError(e){e.preventDefault();const t=e.target.error;p.contains(t.message,"The operation failed for reasons unrelated to the database itself and not covered by any other error code")||p.contains(t.message,"A mutation operation was attempted on a database that did not allow mutations")?f.warn("OneSignal: IndexedDb web storage is not available on this origin since this profile's IndexedDb schema has been upgraded in a newer version of Firefox. See: https://bugzilla.mozilla.org/show_bug.cgi?id=1236557#c6"):f.warn("OneSignal: Fatal error opening IndexedDb database:",t)}onDatabaseError(e){f.debug("IndexedDb: Generic database error",e.target.errorCode)}onDatabaseOpenBlocked(){f.debug("IndexedDb: Blocked event")}onDatabaseVersionChange(e){f.debug("IndexedDb: versionchange event")}onDatabaseUpgradeNeeded(e){f.debug("IndexedDb: Database is being rebuilt or upgraded (upgradeneeded event).");const t=e.target,i=t.transaction;if(!i)throw Error("Can't migrate DB without a transaction");const n=t.result,o=e.newVersion||Number.MAX_SAFE_INTEGER;o>=1&&e.oldVersion<1&&(n.createObjectStore("Ids",{keyPath:"type"}),n.createObjectStore("NotificationOpened",{keyPath:"url"}),n.createObjectStore("Options",{keyPath:"key"})),o>=2&&e.oldVersion<2&&(n.createObjectStore("Sessions",{keyPath:"sessionKey"}),n.createObjectStore("NotificationReceived",{keyPath:"notificationId"}),n.createObjectStore("NotificationClicked",{keyPath:"notificationId"})),o>=3&&e.oldVersion<3&&n.createObjectStore("SentUniqueOutcome",{keyPath:"outcomeName"}),o>=4&&e.oldVersion<4&&(n.createObjectStore(_.Identity,{keyPath:"modelId"}),n.createObjectStore(_.Properties,{keyPath:"modelId"}),n.createObjectStore(_.PushSubscriptions,{keyPath:"modelId"}),n.createObjectStore(_.SmsSubscriptions,{keyPath:"modelId"}),n.createObjectStore(_.EmailSubscriptions,{keyPath:"modelId"})),o>=5&&e.oldVersion<5&&(this.migrateOutcomesNotificationClickedTableForV5(n,i),this.migrateOutcomesNotificationReceivedTableForV5(n,i)),o>=6&&e.oldVersion,"undefined"!=typeof OneSignal&&(OneSignal._isNewVisitor=!0)}migrateOutcomesNotificationClickedTableForV5(e,t){const i="Outcomes.NotificationClicked";e.createObjectStore(i,{keyPath:"notificationId"});const n="NotificationClicked",o=t.objectStore(n).openCursor();o.onsuccess=()=>{if(!o.result)return void e.deleteObjectStore(n);const s=o.result.value;t.objectStore(i).put({notificationId:s.notificationId||s.notification.id,appId:s.appId,timestamp:s.timestamp}),o.result.continue()},o.onerror=()=>{console.error("Could not migrate NotificationClicked records",o.error)}}migrateOutcomesNotificationReceivedTableForV5(e,t){const i="Outcomes.NotificationReceived";e.createObjectStore(i,{keyPath:"notificationId"});const n="NotificationReceived",o=t.objectStore(n).openCursor();o.onsuccess=()=>{o.result?(t.objectStore(i).put(o.result.value),o.result.continue()):e.deleteObjectStore(n)},o.onerror=()=>{console.error("Could not migrate NotificationReceived records",o.error)}}get(t,i){return e(this,void 0,void 0,(function*(){const e=yield this.ensureDatabaseOpen();return i?yield new Promise(((n,o)=>{const s=e.transaction(t).objectStore(t).get(i);s.onsuccess=()=>{n(s.result)},s.onerror=()=>{o(s.error)}})):yield new Promise(((i,n)=>{const o={},s=e.transaction(t).objectStore(t).openCursor();s.onsuccess=e=>{const t=e.target.result;if(t){const e=t.key;o[e]=t.value,t.continue()}else i(o)},s.onerror=()=>{n(s.error)}}))}))}getAll(t){return e(this,void 0,void 0,(function*(){const e=yield this.ensureDatabaseOpen();return yield new Promise(((i,n)=>{const o=e.transaction(t).objectStore(t).openCursor(),s=[];o.onsuccess=e=>{const t=e.target.result;t?(s.push(t.value),t.continue()):i(s)},o.onerror=()=>{n(o.error)}}))}))}put(t,i){return e(this,void 0,void 0,(function*(){return yield this.ensureDatabaseOpen(),yield new Promise(((e,n)=>{try{const o=this.database.transaction([t],"readwrite").objectStore(t).put(i);o.onsuccess=()=>{e(i)},o.onerror=e=>{f.error("Database PUT Transaction Error:",e),n(e)}}catch(e){f.error("Database PUT Error:",e),n(e)}}))}))}remove(t,i){return e(this,void 0,void 0,(function*(){const e=yield this.ensureDatabaseOpen();return new Promise(((n,o)=>{try{const s=e.transaction([t],"readwrite").objectStore(t),r=i?s.delete(i):s.clear();r.onsuccess=()=>{n(i)},r.onerror=e=>{f.error("Database REMOVE Transaction Error:",e),o(e)}}catch(e){f.error("Database REMOVE Error:",e),o(e)}}))}))}}class F{constructor(){this.lastKnownOptedIn=!0}}class V{}class L{serialize(){return{deviceId:this.deviceId,subscriptionToken:this.subscriptionToken,optedOut:this.optedOut,createdAt:this.createdAt,expirationTime:this.expirationTime}}static deserialize(e){const t=new L;return t.deviceId=e.deviceId,t.subscriptionToken=e.subscriptionToken,t.optedOut=e.optedOut,t.createdAt=e.createdAt,t.expirationTime=e.expirationTime,t}}class B{constructor(e,t,i){this.subscriptionId=e,this.identifier=t,this.identifierAuthHash=i}serialize(){return{identifierAuthHash:this.identifierAuthHash,emailAddress:this.identifier,emailId:this.subscriptionId}}static deserialize(e){return new B(e.emailId,e.emailAddress,e.identifierAuthHash)}}class $ extends a{constructor(){super("This code is not implemented yet."),Object.setPrototypeOf(this,$.prototype)}}var H,j,K;!function(e){e[e.ChromeLike=5]="ChromeLike",e[e.SafariLegacy=7]="SafariLegacy",e[e.Firefox=8]="Firefox",e[e.Email=11]="Email",e[e.Edge=12]="Edge",e[e.SMS=14]="SMS",e[e.SafariVapid=17]="SafariVapid"}(H||(H={}));class z{constructor(){this.language=I.getLanguage(),this.timezone=-60*(new Date).getTimezoneOffset(),this.timezoneId=Intl.DateTimeFormat().resolvedOptions().timeZone;const e=parseInt(String(h().version),10);this.browserVersion=isNaN(e)?-1:e,this.deviceModel=navigator.platform,this.sdkVersion=I.version().toString(),this.deliveryPlatform=this.getDeliveryPlatform()}getDeliveryPlatform(){const e=m.redetectBrowserUserAgent();return I.useSafariLegacyPush()?H.SafariLegacy:I.useSafariVapidPush()?H.SafariVapid:e.firefox?H.Firefox:e.msedge?H.Edge:H.ChromeLike}serialize(){const e={device_type:this.deliveryPlatform,language:this.language,timezone:this.timezone,timezone_id:this.timezoneId,device_os:this.browserVersion,device_model:this.deviceModel,sdk:this.sdkVersion,notification_types:this.subscriptionState};return this.appId&&(e.app_id=this.appId),this.externalUserId&&(e.external_user_id=this.externalUserId),this.externalUserIdAuthHash&&(e.external_user_id_auth_hash=this.externalUserIdAuthHash),e}deserialize(e){throw new $}}!function(e){e.Active="active",e.Inactive="inactive",e.Expired="expired"}(j||(j={})),function(e){e[e.PlayerCreate=1]="PlayerCreate",e[e.PlayerOnSession=2]="PlayerOnSession",e[e.VisibilityVisible=3]="VisibilityVisible",e[e.VisibilityHidden=4]="VisibilityHidden",e[e.BeforeUnload=5]="BeforeUnload",e[e.PageRefresh=6]="PageRefresh",e[e.Focus=7]="Focus",e[e.Blur=8]="Blur"}(K||(K={}));const G="oneSignalSession";function q(e){const t=(new Date).getTime(),i=e&&e.sessionKey||G,n=e&&e.notificationId||null,o=z.prototype.getDeliveryPlatform();return{sessionKey:i,appId:e.appId,deviceType:o,startTimestamp:t,accumulatedDuration:0,notificationId:n,status:j.Active,lastDeactivatedTimestamp:null,lastActivatedTimestamp:t}}class J{constructor(e,t,i){this.subscriptionId=e,this.identifier=t,this.identifierAuthHash=i}serialize(){return{identifierAuthHash:this.identifierAuthHash,smsNumber:this.identifier,smsId:this.subscriptionId}}static deserialize(e){return new J(e.smsId,e.smsNumber,e.identifierAuthHash)}}class Y{static toDatabase(e){const t=e.notification,i=e.result;return{id:t.notificationId,heading:t.title,content:t.body,data:t.additionalData,url:i.url,rr:t.confirmDelivery,icon:t.icon,image:t.image,tag:t.topic,badge:t.badgeIcon,action:i.actionId,buttons:this.toDatabaseButtons(t.actionButtons),timestamp:e.timestamp}}static toDatabaseButtons(e){return null==e?void 0:e.map((e=>({action:e.actionId,title:e.text,icon:e.icon,url:e.launchURL})))}static fromDatabase(e){return{result:{actionId:e.action,url:e.url},notification:{notificationId:e.id,title:e.heading,body:e.content,additionalData:e.data,launchURL:e.url,confirmDelivery:e.rr,icon:e.icon,image:e.image,topic:e.tag,badgeIcon:e.badge,actionButtons:this.toOSNotificationButtons(e.buttons)},timestamp:e.timestamp}}static toOSNotificationButtons(e){return null==e?void 0:e.map((e=>({actionId:e.action,text:e.title,icon:e.icon,launchURL:e.url})))}}class Q{static toDatabase(e,t){return{appId:e,notificationId:t.notification.notificationId,timestamp:t.timestamp}}static fromDatabase(e){return{appId:e.appId,notificationId:e.notificationId,timestamp:e.timestamp}}}class X{static toDatabase(e,t,i){return{appId:e,notificationId:t.notificationId,timestamp:i}}static fromDatabase(e){return{appId:e.appId,notificationId:e.notificationId,timestamp:e.timestamp}}}var Z;!function(e){e[e.SET=0]="SET"}(Z||(Z={}));const ee="Outcomes.NotificationClicked",te="Outcomes.NotificationReceived";class ie{constructor(e){this.databaseName=e,this.emitter=new W,this.database=new R(this.databaseName)}static resetInstance(){ie.databaseInstance=null}static get singletonInstance(){return ie.databaseInstanceName||(ie.databaseInstanceName="ONE_SIGNAL_SDK_DB"),ie.databaseInstance||(ie.databaseInstance=new ie(ie.databaseInstanceName)),ie.databaseInstance}static applyDbResultFilter(e,t,i){switch(e){case"Options":return i&&t?i.value:i&&!t?i:null;case"Ids":return i&&t?i.id:i&&!t?i:null;default:return i||null}}shouldUsePostmam(){return S.getWindowEnv()!==o.ServiceWorker&&m.isUsingSubscriptionWorkaround()&&S.getTestEnv()===n.None}get(t,i){return e(this,void 0,void 0,(function*(){if(this.shouldUsePostmam())return yield new Promise((e=>{OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.REMOTE_DATABASE_GET,[{table:t,key:i}],(t=>{const i=t.data[0];e(i)}))}));{const e=yield this.database.get(t,i);return ie.applyDbResultFilter(t,i,e)}}))}getAll(t){return e(this,void 0,void 0,(function*(){if(this.shouldUsePostmam())return yield new Promise((e=>{OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.REMOTE_DATABASE_GET_ALL,{table:t},(t=>{const i=t.data;e(i)}))}));return yield this.database.getAll(t)}))}put(t,i){return e(this,void 0,void 0,(function*(){yield new Promise(((e,s)=>{S.getWindowEnv()!==o.ServiceWorker&&m.isUsingSubscriptionWorkaround()&&S.getTestEnv()===n.None?OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.REMOTE_DATABASE_PUT,[{table:t,keypath:i}],(n=>{n.data===OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE?e():s(`(Database) Attempted remote IndexedDB put(${t}, ${i}),but did not get success response.`)})):this.database.put(t,i).then((()=>e()))})),this.emitter.emit(ie.EVENTS.SET,i)}))}remove(e,t){return S.getWindowEnv()!==o.ServiceWorker&&m.isUsingSubscriptionWorkaround()&&S.getTestEnv()===n.None?new Promise(((i,n)=>{OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.REMOTE_DATABASE_REMOVE,[{table:e,keypath:t}],(o=>{o.data===OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE?i():n(`(Database) Attempted remote IndexedDB remove(${e}, ${t}),but did not get success response.`)}))})):this.database.remove(e,t)}getAppConfig(){return e(this,void 0,void 0,(function*(){const e={},t=yield this.get("Ids","appId");return e.appId=t,e.subdomain=yield this.get("Options","subdomain"),e.vapidPublicKey=yield this.get("Options","vapidPublicKey"),e}))}getExternalUserId(){return e(this,void 0,void 0,(function*(){return yield this.get("Ids","externalUserId")}))}getExternalUserIdAuthHash(){return e(this,void 0,void 0,(function*(){return yield this.get("Ids","externalUserIdAuthHash")}))}setExternalUserId(t,i){return e(this,void 0,void 0,(function*(){const e=p.getValueOrDefault(t,""),n=p.getValueOrDefault(i,"");""===e?yield this.remove("Ids","externalUserId"):yield this.put("Ids",{type:"externalUserId",id:e}),""===n?yield this.remove("Ids","externalUserIdAuthHash"):yield this.put("Ids",{type:"externalUserIdAuthHash",id:n})}))}setAppConfig(t){return e(this,void 0,void 0,(function*(){t.appId&&(yield this.put("Ids",{type:"appId",id:t.appId})),t.subdomain&&(yield this.put("Options",{key:"subdomain",value:t.subdomain})),!0===t.httpUseOneSignalCom?yield this.put("Options",{key:"httpUseOneSignalCom",value:!0}):!1===t.httpUseOneSignalCom&&(yield this.put("Options",{key:"httpUseOneSignalCom",value:!1})),t.vapidPublicKey&&(yield this.put("Options",{key:"vapidPublicKey",value:t.vapidPublicKey}))}))}getAppState(){return e(this,void 0,void 0,(function*(){const e=new F;return e.defaultNotificationUrl=yield this.get("Options","defaultUrl"),e.defaultNotificationTitle=yield this.get("Options","defaultTitle"),e.lastKnownPushEnabled=yield this.get("Options","isPushEnabled"),e.pendingNotificationClickEvents=yield this.getAllPendingNotificationClickEvents(),e.lastKnownPushId=yield this.get("Options","lastPushId"),e.lastKnownPushToken=yield this.get("Options","lastPushToken"),e.lastKnownOptedIn=yield this.get("Options","lastOptedIn"),e}))}setIsPushEnabled(t){return e(this,void 0,void 0,(function*(){yield this.put("Options",{key:"isPushEnabled",value:t})}))}setAppState(t){return e(this,void 0,void 0,(function*(){if(t.defaultNotificationUrl&&(yield this.put("Options",{key:"defaultUrl",value:t.defaultNotificationUrl})),(t.defaultNotificationTitle||""===t.defaultNotificationTitle)&&(yield this.put("Options",{key:"defaultTitle",value:t.defaultNotificationTitle})),null!=t.lastKnownPushEnabled&&(yield this.setIsPushEnabled(t.lastKnownPushEnabled)),null!=t.lastKnownPushId&&(yield this.put("Options",{key:"lastPushId",value:t.lastKnownPushId})),null!=t.lastKnownPushToken&&(yield this.put("Options",{key:"lastPushToken",value:t.lastKnownPushToken})),null!=t.lastKnownOptedIn&&(yield this.put("Options",{key:"lastOptedIn",value:t.lastKnownOptedIn})),t.pendingNotificationClickEvents){const e=Object.keys(t.pendingNotificationClickEvents);for(const i of e){const e=t.pendingNotificationClickEvents[i];e?yield this.put("NotificationOpened",{url:i,data:e.data,timestamp:e.timestamp}):null===e&&(yield this.remove("NotificationOpened",i))}}}))}getServiceWorkerState(){return e(this,void 0,void 0,(function*(){const e=new V;return e.workerVersion=yield this.get("Ids","WORKER1_ONE_SIGNAL_SW_VERSION"),e}))}setServiceWorkerState(t){return e(this,void 0,void 0,(function*(){t.workerVersion&&(yield this.put("Ids",{type:"WORKER1_ONE_SIGNAL_SW_VERSION",id:t.workerVersion}))}))}getSubscription(){return e(this,void 0,void 0,(function*(){const e=new L;e.deviceId=yield this.get("Ids","userId"),e.subscriptionToken=yield this.get("Ids","registrationId");const t=yield this.get("Options","optedOut"),i=yield this.get("Options","subscription"),n=yield this.get("Options","subscriptionCreatedAt"),o=yield this.get("Options","subscriptionExpirationTime");return e.optedOut=null!=t?t:null!=i&&!i,e.createdAt=n,e.expirationTime=o,e}))}setDeviceId(t){return e(this,void 0,void 0,(function*(){yield this.put("Ids",{type:"userId",id:t})}))}setSubscription(t){return e(this,void 0,void 0,(function*(){t.deviceId&&(yield this.setDeviceId(t.deviceId)),void 0!==t.subscriptionToken&&(yield this.put("Ids",{type:"registrationId",id:t.subscriptionToken})),null!=t.optedOut&&(yield this.put("Options",{key:"optedOut",value:t.optedOut})),null!=t.createdAt&&(yield this.put("Options",{key:"subscriptionCreatedAt",value:t.createdAt})),null!=t.expirationTime?yield this.put("Options",{key:"subscriptionExpirationTime",value:t.expirationTime}):yield this.remove("Options","subscriptionExpirationTime")}))}setJWTToken(t){return e(this,void 0,void 0,(function*(){yield this.put("Ids",{type:"jwtToken",id:t})}))}getJWTToken(){return e(this,void 0,void 0,(function*(){return yield this.get("Ids","jwtToken")}))}getEmailProfile(){return e(this,void 0,void 0,(function*(){const e=yield this.get("Ids","emailProfile");return e?B.deserialize(e):new B}))}setEmailProfile(t){return e(this,void 0,void 0,(function*(){t&&(yield this.put("Ids",{type:"emailProfile",id:t.serialize()}))}))}getSMSProfile(){return e(this,void 0,void 0,(function*(){const e=yield this.get("Ids","smsProfile");return e?J.deserialize(e):new J}))}setSMSProfile(t){return e(this,void 0,void 0,(function*(){t&&(yield this.put("Ids",{type:"smsProfile",id:t.serialize()}))}))}setProvideUserConsent(t){return e(this,void 0,void 0,(function*(){yield this.put("Options",{key:"userConsent",value:t})}))}getConsentGiven(){return e(this,void 0,void 0,(function*(){return yield this.get("Options","userConsent")}))}getSession(t){return e(this,void 0,void 0,(function*(){return yield this.get("Sessions",t)}))}setSession(t){return e(this,void 0,void 0,(function*(){yield this.put("Sessions",t)}))}removeSession(t){return e(this,void 0,void 0,(function*(){yield this.remove("Sessions",t)}))}getLastNotificationClickedForOutcomes(t){return e(this,void 0,void 0,(function*(){let e=[];try{e=yield this.getAllNotificationClickedForOutcomes()}catch(e){f.error("Database.getLastNotificationClickedForOutcomes",e)}return e.find((e=>e.appId===t))||null}))}getAllNotificationClickedForOutcomes(){return e(this,void 0,void 0,(function*(){return(yield this.getAll(ee)).map((e=>Q.fromDatabase(e)))}))}putNotificationClickedForOutcomes(t,i){return e(this,void 0,void 0,(function*(){yield this.put(ee,Q.toDatabase(t,i))}))}putNotificationClickedEventPendingUrlOpening(t){return e(this,void 0,void 0,(function*(){yield this.put("NotificationOpened",Y.toDatabase(t))}))}getAllPendingNotificationClickEvents(){return e(this,void 0,void 0,(function*(){const e={},t=yield this.getAll("NotificationOpened");for(const i of t){const t=Y.fromDatabase(i),n=t.result.url;n&&(e[n]=t)}return e}))}removeAllNotificationClickedForOutcomes(){return e(this,void 0,void 0,(function*(){yield this.remove(ee)}))}getAllNotificationReceivedForOutcomes(){return e(this,void 0,void 0,(function*(){return(yield this.getAll(te)).map((e=>X.fromDatabase(e)))}))}putNotificationReceivedForOutcomes(t,i){return e(this,void 0,void 0,(function*(){yield this.put(te,X.toDatabase(t,i,(new Date).getTime()))}))}resetSentUniqueOutcomes(){return e(this,void 0,void 0,(function*(){const e=(yield this.getAll("SentUniqueOutcome")).map((e=>(e.sentDuringSession=null,ie.put("SentUniqueOutcome",e))));yield Promise.all(e)}))}static rebuild(){return e(this,void 0,void 0,(function*(){return Promise.all([ie.singletonInstance.remove("Ids"),ie.singletonInstance.remove("NotificationOpened"),ie.singletonInstance.remove("Options"),ie.singletonInstance.remove(te),ie.singletonInstance.remove(ee),ie.singletonInstance.remove("SentUniqueOutcome")])}))}static on(...t){return e(this,void 0,void 0,(function*(){return ie.singletonInstance.emitter.on.apply(ie.singletonInstance.emitter,t)}))}static setIsPushEnabled(t){return e(this,void 0,void 0,(function*(){return ie.singletonInstance.setIsPushEnabled(t)}))}static getCurrentSession(){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.getSession(G)}))}static upsertSession(t){return e(this,void 0,void 0,(function*(){yield ie.singletonInstance.setSession(t)}))}static cleanupCurrentSession(){return e(this,void 0,void 0,(function*(){yield ie.singletonInstance.removeSession(G)}))}static setEmailProfile(t){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.setEmailProfile(t)}))}static getEmailProfile(){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.getEmailProfile()}))}static setSMSProfile(t){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.setSMSProfile(t)}))}static getSMSProfile(){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.getSMSProfile()}))}static setSubscription(t){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.setSubscription(t)}))}static getSubscription(){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.getSubscription()}))}static setJWTToken(t){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.setJWTToken(t)}))}static getJWTToken(){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.getJWTToken()}))}static setConsentGiven(t){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.setProvideUserConsent(t)}))}static getConsentGiven(){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.getConsentGiven()}))}static setServiceWorkerState(t){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.setServiceWorkerState(t)}))}static getServiceWorkerState(){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.getServiceWorkerState()}))}static setAppState(t){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.setAppState(t)}))}static getAppState(){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.getAppState()}))}static setAppConfig(t){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.setAppConfig(t)}))}static getAppConfig(){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.getAppConfig()}))}static getExternalUserId(){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.getExternalUserId()}))}static getExternalUserIdAuthHash(){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.getExternalUserIdAuthHash()}))}static getLastNotificationClickedForOutcomes(t){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.getLastNotificationClickedForOutcomes(t)}))}static removeAllNotificationClickedForOutcomes(){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.removeAllNotificationClickedForOutcomes()}))}static getAllNotificationReceivedForOutcomes(){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.getAllNotificationReceivedForOutcomes()}))}static putNotificationReceivedForOutcomes(t,i){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.putNotificationReceivedForOutcomes(t,i)}))}static getAllNotificationClickedForOutcomes(){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.getAllNotificationClickedForOutcomes()}))}static putNotificationClickedForOutcomes(t,i){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.putNotificationClickedForOutcomes(t,i)}))}static putNotificationClickedEventPendingUrlOpening(t){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.putNotificationClickedEventPendingUrlOpening(t)}))}static resetSentUniqueOutcomes(){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.resetSentUniqueOutcomes()}))}static setExternalUserId(t,i){return e(this,void 0,void 0,(function*(){yield ie.singletonInstance.setExternalUserId(t,i)}))}static setDeviceId(t){return e(this,void 0,void 0,(function*(){yield ie.singletonInstance.setDeviceId(t)}))}static remove(t,i){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.remove(t,i)}))}static put(t,i){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.put(t,i)}))}static get(t,i){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.get(t,i)}))}static getAll(t){return e(this,void 0,void 0,(function*(){return yield ie.singletonInstance.getAll(t)}))}}ie.EVENTS=Z;const ne=["notifyButtonHovering","notifyButtonHover","notifyButtonButtonClick","notifyButtonLauncherClick","animatedElementHiding","animatedElementHidden","animatedElementShowing","animatedElementShown","activeAnimatedElementActivating","activeAnimatedElementActive","activeAnimatedElementInactivating","activeAnimatedElementInactive","dbRetrieved","dbSet","testEvent"],oe=["onesignal.prompt.custom.clicked","onesignal.prompt.native.permissionchanged","onesignal.subscription.changed","onesignal.internal.subscriptionset","dbRebuilt","initialize","subscriptionSet","sendWelcomeNotification","subscriptionChange","permissionChange","dbSet","register","willDisplay","dismiss","click","permissionPromptDisplay","testWouldDisplay","testInitOptionDisabled","popupWindowTimeout"],se={permissionChange:"onesignal.prompt.native.permissionchanged",subscriptionChange:"onesignal.subscription.changed",customPromptClick:"onesignal.prompt.custom.clicked"};class re{static trigger(t,i,n=null){return e(this,void 0,void 0,(function*(){if(!p.contains(ne,t)){const e=i;let o=p.capitalize(S.getWindowEnv().toString());n&&(o=`${o} â¬¸ ${p.capitalize(n)}`),e||!1===e?f.debug(`(${o}) Â» ${t}:`,e):f.debug(`(${o}) Â» ${t}`)}if(I.isBrowser()){if(t===OneSignal.EVENTS.SDK_INITIALIZED){if(OneSignal.initialized)return;OneSignal.initialized=!0}yield OneSignal.emitter.emit(t,i)}if(se.hasOwnProperty(t)){const e=se[t];re._triggerLegacy(e,i)}if(I.isBrowser()&&(S.getWindowEnv()===o.OneSignalSubscriptionPopup||S.getWindowEnv()===o.OneSignalProxyFrame)){opener||parent?p.contains(oe,t)&&(S.getWindowEnv()===o.OneSignalSubscriptionPopup?OneSignal.subscriptionPopup.message(OneSignal.POSTMAM_COMMANDS.REMOTE_RETRIGGER_EVENT,{eventName:t,eventData:i}):OneSignal.proxyFrame.retriggerRemoteEvent(t,i)):f.error(`Could not send event '${t}' back to host page because no creator (opener or parent) found!`)}}))}static _triggerLegacy(e,t){const i=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:t});window.dispatchEvent(i)}}class ae extends a{constructor(e,t){super("Registration of a Service Worker failed."),this.status=e,this.statusText=t,Object.setPrototypeOf(this,ae.prototype)}}const ce=ae;class de{static debug(...e){self.shouldLog&&console.debug(...e)}static trace(...e){self.shouldLog&&console.trace(...e)}static info(...e){self.shouldLog&&console.info(...e)}static warn(...e){self.shouldLog&&console.warn(...e)}static error(...e){self.shouldLog&&console.error(...e)}}const ue=()=>{de.debug("Do nothing")};function le(t,i){const n=1e3*i;let o,s;const r=new Promise(((i,r)=>{let a=!1;o=self.setTimeout((()=>e(this,void 0,void 0,(function*(){a=!0;try{yield t(),i()}catch(e){de.error("Failed to execute callback",e),r()}}))),n),s=()=>{de.debug("Cancel called"),self.clearTimeout(o),a||i()}}));return s?{promise:r,cancel:s}:(de.warn("clearTimeoutHandle was not assigned."),{promise:r,cancel:ue})}var ge;!function(e){e[e.Direct=1]="Direct",e[e.Indirect=2]="Indirect",e[e.Unattributed=3]="Unattributed",e[e.NotSupported=4]="NotSupported"}(ge||(ge={}));class pe{static triggerNotificationPermissionChanged(t=!1){return e(this,void 0,void 0,(function*(){if(!pe.executing){pe.executing=!0;try{yield pe.privateTriggerNotificationPermissionChanged(t)}finally{pe.executing=!1}}}))}static privateTriggerNotificationPermissionChanged(t){return e(this,void 0,void 0,(function*(){const e=yield OneSignal.context.permissionManager.getPermissionStatus(),i=yield ie.get("Options","notificationPermission");(e!==i||t)&&(yield ie.put("Options",{key:"notificationPermission",value:e}),re.trigger(OneSignal.EVENTS.NOTIFICATION_PERMISSION_CHANGED_AS_STRING,e),this.triggerBooleanPermissionChangeEvent(i,e,t))}))}static triggerBooleanPermissionChangeEvent(e,t,i){const n="granted"===t;(n!==("granted"===e)||i)&&re.trigger(OneSignal.EVENTS.NOTIFICATION_PERMISSION_CHANGED_AS_BOOLEAN,n)}}function fe(){return e(this,void 0,void 0,(function*(){return new Promise((e=>{OneSignal.initialized?e():OneSignal.emitter.once(OneSignal.EVENTS.SDK_INITIALIZED,e)}))}))}function he(e,...t){return v.logMethodCall(e,...t)}function ve(e,t){if("string"==typeof e){const i=document.querySelector(e);if(null===i)throw new Error(`Cannot find element with selector "${e}"`);i.classList.add(t)}else{if("object"!=typeof e)throw new Error(`${e} must be a CSS selector string or DOM Element object.`);e.classList.add(t)}}function me(e){return JSON.parse(JSON.stringify(e))}pe.executing=!1;class be{constructor(e,t,i,n){this.outcomeName=i,this.config=t,this.appId=e,this.isUnique=n}getAttribution(){return e(this,void 0,void 0,(function*(){return yield be.getAttribution(this.config)}))}beforeOutcomeSend(){return e(this,void 0,void 0,(function*(){if(he(this.isUnique?"sendUniqueOutcome":"sendOutcome",this.outcomeName),!this.config)return f.debug("Outcomes feature not supported by main application yet."),!1;if(!this.outcomeName)return f.error("Outcome name is required"),!1;yield fe();return!!(yield OneSignal.context.subscriptionManager.isPushNotificationsEnabled())||(f.warn("Reporting outcomes is supported only for subscribed users."),!1)}))}getAttributedNotifsByUniqueOutcomeName(){return e(this,void 0,void 0,(function*(){return(yield ie.getAll("SentUniqueOutcome")).filter((e=>e.outcomeName===this.outcomeName)).reduce(((e,t)=>[...e,...t.notificationIds||[]]),[])}))}getNotifsToAttributeWithUniqueOutcome(t){return e(this,void 0,void 0,(function*(){const e=yield this.getAttributedNotifsByUniqueOutcomeName();return t.filter((t=>-1===e.indexOf(t)))}))}shouldSendUnique(e,t){return e.type===ge.Unattributed||t.length>0}saveSentUniqueOutcome(t){return e(this,void 0,void 0,(function*(){const e=this.outcomeName,i=yield ie.get("SentUniqueOutcome",e),n=yield ie.getCurrentSession(),o=[...i?i.notificationIds:[],...t],s=n?n.startTimestamp:null;yield ie.put("SentUniqueOutcome",{outcomeName:e,notificationIds:o,sentDuringSession:s})}))}wasSentDuringSession(){return e(this,void 0,void 0,(function*(){const e=yield ie.get("SentUniqueOutcome",this.outcomeName);if(!e)return!1;const t=yield ie.getCurrentSession(),i=t&&e.sentDuringSession===t.startTimestamp,n=!t&&!!e.sentDuringSession;return i||n}))}send(t){return e(this,void 0,void 0,(function*(){const{type:e,notificationIds:i,weight:n}=t;switch(e){case ge.Direct:return this.isUnique&&(yield this.saveSentUniqueOutcome(i)),void(yield OneSignal.context.updateManager.sendOutcomeDirect(this.appId,i,this.outcomeName,n));case ge.Indirect:return this.isUnique&&(yield this.saveSentUniqueOutcome(i)),void(yield OneSignal.context.updateManager.sendOutcomeInfluenced(this.appId,i,this.outcomeName,n));case ge.Unattributed:if(this.isUnique){if(yield this.wasSentDuringSession())return void f.warn("(Unattributed) unique outcome was already sent during this session");yield this.saveSentUniqueOutcome([])}return void(yield OneSignal.context.updateManager.sendOutcomeUnattributed(this.appId,this.outcomeName,n));default:return void f.warn("You are on a free plan. Please upgrade to use this functionality.")}}))}static getAttribution(t){return e(this,void 0,void 0,(function*(){if(t.direct&&t.direct.enabled){const e=yield ie.getAllNotificationClickedForOutcomes();if(e.length>0)return{type:ge.Direct,notificationIds:[e[0].notificationId]}}if(t.indirect&&t.indirect.enabled){const e=60*t.indirect.influencedTimePeriodMin*1e3,i=new Date((new Date).getTime()-e).getTime(),n=yield ie.getAllNotificationReceivedForOutcomes();if(f.debug(`\tFound total of ${n.length} received notifications`),n.length>0){const e=t.indirect.influencedNotificationsLimit,o=g.sortArrayOfObjects(n,(e=>e.timestamp),!0,!1),s=o.filter((e=>e.timestamp>=i)).slice(0,e).map((e=>e.notificationId));f.debug(`\tTotal of ${s.length} received notifications are within reporting window.`);const r=o.filter((e=>-1===s.indexOf(e.notificationId))).map((e=>e.notificationId));if(r.forEach((e=>ie.remove(te,e))),f.debug(`\t${r.length} received notifications will be deleted.`),s.length>0)return{type:ge.Indirect,notificationIds:s}}}return t.unattributed&&t.unattributed.enabled?{type:ge.Unattributed,notificationIds:[]}:{type:ge.NotSupported,notificationIds:[]}}))}}var Se,ye,we;!function(e){e.iOS="iOS",e.Android="Android",e.FireOS="FireOS",e.ChromeExtension="ChromeExtension",e.ChromePush="ChromePush",e.WindowPush="WindowPush",e.SafariPush="SafariPush",e.SafariLegacyPush="SafariLegacyPush",e.FirefoxPush="FirefoxPush",e.HuaweiPush="HuaweiPush",e.macOSPush="macOSPush",e.AlexaPush="AlexaPush",e.Email="Email",e.SMS="SMS"}(Se||(Se={})),function(e){e.Safari="safari",e.Firefox="firefox",e.Chrome="chrome",e.Opera="opera",e.Edge="edge",e.Other="other"}(ye||(ye={}));class Oe{static getEnvironmentInfo(){return{browserType:this.getBrowser(),browserVersion:this.getBrowserVersion(),isHttps:this.isHttps(),isUsingSubscriptionWorkaround:this.isUsingSubscriptionWorkaround(),isBrowserAndSupportsServiceWorkers:this.supportsServiceWorkers(),requiresUserInteraction:this.requiresUserInteraction(),osVersion:this.getOsVersion(),canTalkToServiceWorker:this.canTalkToServiceWorker()}}static getBrowser(){return"chrome"===h().name?ye.Chrome:"msedge"===h().name?ye.Edge:"opera"===h().name?ye.Opera:"firefox"===h().name?ye.Firefox:this.isMacOSSafari()?ye.Safari:ye.Other}static isMacOSSafari(){return void 0!==window.safari||y()}static getBrowserVersion(){return p.parseVersionString(h().version)}static isHttps(){return!!window&&(window.location&&"https:"===window.location.protocol)}static isUsingSubscriptionWorkaround(){return v.isUsingSubscriptionWorkaround()}static supportsServiceWorkers(){return window.navigator&&"serviceWorker"in window.navigator}static requiresUserInteraction(){return"firefox"===this.getBrowser()&&this.getBrowserVersion()>=72||"safari"===this.getBrowser()&&this.getBrowserVersion()>=12.1}static getOsVersion(){return u().osversion}static canTalkToServiceWorker(){return!!window.isSecureContext}}!function(e){e[e.NoNativePermission=0]="NoNativePermission",e[e.Subscribed=1]="Subscribed",e[e.UserOptedOut=-2]="UserOptedOut",e[e.NotSubscribed=-10]="NotSubscribed",e[e.TemporaryWebRecord=-20]="TemporaryWebRecord",e[e.PermissionRevoked=-21]="PermissionRevoked",e[e.PushSubscriptionRevoked=-22]="PushSubscriptionRevoked",e[e.ServiceWorkerStatus403=-23]="ServiceWorkerStatus403",e[e.ServiceWorkerStatus404=-24]="ServiceWorkerStatus404"}(we||(we={}));class Ie{constructor(e){const t=Oe.getEnvironmentInfo();this.token=this._getToken(e),this.type=Ie.getSubscriptionType(),this.notificationTypes=we.Subscribed,this.sdk=String(160100),this.deviceModel=navigator.platform,this.deviceOs=isNaN(t.browserVersion)?-1:t.browserVersion,this.webAuth=e.w3cAuth,this.webp256=e.w3cP256dh}_getToken(e){return e.w3cEndpoint?e.w3cEndpoint.toString():e.safariDeviceToken}serialize(){return{type:this.type,token:this.token,enabled:this.enabled,notification_types:this.notificationTypes,sdk:this.sdk,device_model:this.deviceModel,device_os:this.deviceOs,web_auth:this.webAuth,web_p256:this.webp256}}static getSubscriptionType(){const e=m.redetectBrowserUserAgent();return e.firefox?Se.FirefoxPush:I.useSafariVapidPush()?Se.SafariPush:I.useSafariLegacyPush()?Se.SafariLegacyPush:e.msedge?Se.WindowPush:Se.ChromePush}}class Pe{constructor(e,t){this.label=e,this.id=t}}Pe.ONESIGNAL_ID="onesignal_id",Pe.EXTERNAL_ID="external_id";function ke(e){return new Promise((t=>setTimeout(t,e)))}const xe={5:1e4,4:2e4,3:3e4,2:3e4,1:3e4};class Ee{static get(e,t,i){return Ee.call("GET",e,t,i)}static post(e,t,i){return Ee.call("POST",e,t,i)}static put(e,t,i){return Ee.call("PUT",e,t,i)}static delete(e,t,i){return Ee.call("DELETE",e,t,i)}static patch(e,t,i){return Ee.call("PATCH",e,t,i)}static call(e,t,i,n){if("GET"===e){if(t.indexOf("players")>-1&&-1===t.indexOf("app_id="))return console.error("Calls to player api are not permitted without app_id"),Promise.reject(new l(c.MissingAppId))}else if(t.indexOf("players")>-1&&(!i||!i.app_id))return console.error("Calls to player api are not permitted without app_id"),Promise.reject(new l(c.MissingAppId));const o=new Headers;if(o.append("Origin",S.getOrigin()),o.append("SDK-Version",`onesignal/web/${I.version()}`),o.append("Content-Type","application/json;charset=UTF-8"),n)for(const e of Object.keys(n))o.append(e,n[e]);const s={method:e||"NO_METHOD_SPECIFIED",headers:o,cache:"no-cache"};i&&(s.body=JSON.stringify(i));const r=`${S.getOneSignalApiUrl(void 0,t).toString()}/${t}`;return Ee.executeFetch(r,s)}static executeFetch(t,i,o=5){return e(this,void 0,void 0,(function*(){if(0===o)return Promise.reject(new l(c.RetryLimitReached));try{i.headers&&S.getTestEnv()===n.UnitTesting&&(i.headers=(e=>{const t={};return e instanceof Headers?e.forEach(((e,i)=>{t[i]=e})):Array.isArray(e)?e.forEach((([e,i])=>{t[e]=i})):"object"==typeof e&&Object.assign(t,e),t})(i.headers));const e=yield fetch(t,i),{status:o}=e;return{result:yield e.json(),status:o}}catch(e){if("TypeError"===e.name)return yield ke(xe[o]),f.error(`OneSignal: Network timed out while calling ${t}. Retrying...`),Ee.executeFetch(t,i,o-1);throw new a(`OneSignalApiBase: failed to execute HTTP call: ${e}`)}}))}}const Ce=Ee;function Ne(e){return encodeURIComponent(e).replace(/[!'()*]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`))}var Ae;!function(e){e[e.InvalidAppId=0]="InvalidAppId",e[e.AppNotConfiguredForWebPush=1]="AppNotConfiguredForWebPush",e[e.MissingSubdomain=2]="MissingSubdomain",e[e.WrongSiteUrl=3]="WrongSiteUrl",e[e.MultipleInitialization=4]="MultipleInitialization",e[e.MissingSafariWebId=5]="MissingSafariWebId",e[e.Unknown=6]="Unknown"}(Ae||(Ae={}));class SdkInitError extends a{constructor(e,t){let i;switch(e){case Ae.InvalidAppId:i="OneSignal: This app ID does not match any existing app. Double check your app ID.";break;case Ae.AppNotConfiguredForWebPush:i="OneSignal: This app ID does not have any web platforms enabled. Double check your app ID, or see step 1 on our setup guide (https://tinyurl.com/2x5jzk83).";break;case Ae.MissingSubdomain:i="Non-HTTPS pages require the subdomainName parameter within the label set within the OneSignal Web configuration (https://tinyurl.com/ry39x7mk).";break;case Ae.WrongSiteUrl:i=t&&t.siteUrl?`OneSignal: This web push config can only be used on ${new URL(t.siteUrl).origin}. Your current origin is ${location.origin}.`:"OneSignal: This web push config can not be used on the current site.";break;case Ae.MultipleInitialization:i="OneSignal: The OneSignal web SDK can only be initialized once. Extra initializations are ignored. Please remove calls initializing the SDK more than once.";break;case Ae.MissingSafariWebId:i="OneSignal: Safari browser support on Mac OS X requires the Safari web platform to be enabled. Please see the Safari Support steps in our web setup guide.";break;case Ae.Unknown:i="OneSignal: An unknown initialization error occurred."}super(i),this.reason=Ae[e],Object.setPrototypeOf(this,SdkInitError.prototype)}}class Te{static createUser(t,i){return e(this,void 0,void 0,(function*(){const{appId:e}=t;return Ce.post(`apps/${e}/users`,i,t.jwtHeader)}))}static getUser(t,i){return e(this,void 0,void 0,(function*(){const{appId:e}=t;return Ce.get(`apps/${e}/users/by/${i.label}/${i.id}`,t.jwtHeader)}))}static updateUser(t,i,n){return e(this,void 0,void 0,(function*(){const{appId:e,subscriptionId:o}=t;if(!m.isValidUuid(e))throw new SdkInitError(Ae.InvalidAppId);const s=o?{"OneSignal-Subscription-Id":o}:void 0;let r={};s&&(r=Object.assign(Object.assign({},r),s)),t.jwtHeader&&(r=Object.assign(Object.assign({},r),t.jwtHeader));const a=Ne(i.label),c=Ne(i.id);return Ce.patch(`apps/${e}/users/by/${a}/${c}`,n,r)}))}static deleteUser(t,i){return e(this,void 0,void 0,(function*(){const{appId:e}=t;return Ce.delete(`apps/${e}/users/by/${i.label}/${i.id}`,t.jwtHeader)}))}static addAlias(t,i,n){return e(this,void 0,void 0,(function*(){const{appId:e}=t;return Ce.patch(`apps/${e}/users/by/${i.label}/${i.id}/identity`,{identity:n},t.jwtHeader)}))}static getUserIdentity(t,i){return e(this,void 0,void 0,(function*(){const{appId:e}=t;return Ce.get(`apps/${e}/users/by/${i.label}/${i.id}/identity`,t.jwtHeader)}))}static deleteAlias(t,i,n){return e(this,void 0,void 0,(function*(){const{appId:e}=t;return Ce.delete(`apps/${e}/users/by/${i.label}/${i.id}/identity/${n}`,t.jwtHeader)}))}static createSubscription(t,i,n){return e(this,void 0,void 0,(function*(){const{appId:e}=t;return Ce.post(`apps/${e}/users/by/${i.label}/${i.id}/subscriptions`,n,t.jwtHeader)}))}static updateSubscription(t,i,n){return e(this,void 0,void 0,(function*(){const{appId:e}=t;return Ce.patch(`apps/${e}/subscriptions/${i}`,{subscription:n})}))}static deleteSubscription(t,i){return e(this,void 0,void 0,(function*(){const{appId:e}=t;return Ce.delete(`apps/${e}/subscriptions/${i}`)}))}static fetchAliasesForSubscription(t,i){return e(this,void 0,void 0,(function*(){const{appId:e}=t;return Ce.get(`apps/${e}/subscriptions/${i}/identity`)}))}static identifyUserForSubscription(t,i,n){return e(this,void 0,void 0,(function*(){const{appId:e}=t;return Ce.patch(`apps/${e}/users/by/subscriptions/${i}/identity`,{identity:n},t.jwtHeader)}))}static transferSubscription(t,i,n,o){return e(this,void 0,void 0,(function*(){const{appId:e}=t;return Ce.patch(`apps/${e}/subscriptions/${i}/owner`,{identity:Object.assign({},n),retain_previous_owner:o},t.jwtHeader)}))}}class Me{static getPlayer(e,t){return p.enforceAppId(e),p.enforcePlayerId(t),Ce.get(`players/${t}?app_id=${e}`)}static updatePlayer(e,t,i){return p.enforceAppId(e),p.enforcePlayerId(t),Ce.put(`players/${t}`,Object.assign({app_id:e},i))}static sendNotification(e,t,i,n,o,s,r,a){const c={app_id:e,contents:n,include_player_ids:t,isAnyWeb:!0,data:r,web_buttons:a};return i&&(c.headings=i),o&&(c.url=o),s&&(c.chrome_web_icon=s,c.firefox_icon=s),p.trimUndefined(c),Ce.post("notifications",c)}static createUser(t){return e(this,void 0,void 0,(function*(){const e=t.serialize();p.enforceAppId(e.app_id);const i=yield Ce.post("players",e);return i&&i.result.success?i.result.id:null}))}static logoutEmail(t,i,n){return e(this,void 0,void 0,(function*(){p.enforceAppId(t.appId),p.enforcePlayerId(n);const e=yield Ce.post(`players/${n}/email_logout`,{app_id:t.appId,parent_player_id:i.subscriptionId,identifier_auth_hash:i.identifierAuthHash?i.identifierAuthHash:void 0});return!(!e||!e.result.success)}))}static updateUserSession(t,i){return e(this,void 0,void 0,(function*(){try{const e=i.serialize();p.enforceAppId(e.app_id),p.enforcePlayerId(t);const n=yield Ce.post(`players/${t}/on_session`,e);return(null==n?void 0:n.result.id)?null==n?void 0:n.result.id:t}catch(e){throw e&&Array.isArray(e.errors)&&e.errors.length>0&&p.contains(e.errors[0],"app_id not found")?new l(c.MissingAppId):e}}))}static sendOutcome(t){return e(this,void 0,void 0,(function*(){f.info("Outcome payload:",t);try{yield Ce.post("outcomes/measure",t)}catch(e){f.error("sendOutcome",e)}}))}}const De=class{static downloadServerAppConfig(t){return e(this,void 0,void 0,(function*(){p.enforceAppId(t);const e=yield Ee.get(`sync/${t}/web`,null);return null==e?void 0:e.result}))}static getUserIdFromSubscriptionIdentifier(e,t,i){return p.enforceAppId(e),Ee.post("players",{app_id:e,device_type:t,identifier:i,notification_types:we.TemporaryWebRecord}).then((e=>e&&e.id?e.id:null)).catch((e=>(f.debug("Error getting user ID from subscription identifier:",e),null)))}static updatePlayer(t,i,n){return e(this,void 0,void 0,(function*(){return yield p.enforceAppIdAndPlayerId(t,i,(()=>e(this,void 0,void 0,(function*(){yield Ee.put(`players/${i}`,Object.assign({app_id:t},n))}))))}))}static updateUserSession(t,i,n){return e(this,void 0,void 0,(function*(){const e=new Pe(Pe.ONESIGNAL_ID,i),o={refresh_device_metadata:!0,deltas:{session_count:1}};p.enforceAppId(t),p.enforceAlias(e);try{yield Te.updateUser({appId:t,subscriptionId:n},e,o)}catch(e){f.debug("Error updating user session:",e)}}))}static sendSessionDuration(t,i,n,o,s){return e(this,void 0,void 0,(function*(){const e={refresh_device_metadata:!0,deltas:{session_time:o}},r=new Pe(Pe.ONESIGNAL_ID,i),a={id:"os__session_duration",app_id:t,session_time:o,notification_ids:s.notificationIds,subscription:{id:n,type:Ie.getSubscriptionType()},onesignal_id:i};a.direct=s.type===ge.Direct;try{yield Te.updateUser({appId:t,subscriptionId:n},r,e),a.notification_ids&&a.notification_ids.length>0&&(yield Me.sendOutcome(a))}catch(e){f.debug("Error sending session duration:",e)}}))}};class Ue{static getServiceWorkerHref(e,t,i){return Ue.appendServiceWorkerParams(e.workerPath.getFullPath(),t,i)}static appendServiceWorkerParams(e,t,i){return`${new URL(e,v.getBaseUrl()).href}?${p.encodeHashAsUriComponent({appId:t})}&${p.encodeHashAsUriComponent({sdkVersion:i})}`}static upsertSession(t,i,n,o,s,r,a){return e(this,void 0,void 0,(function*(){const e=yield ie.getCurrentSession();if(!e){const e=q({appId:t}),o=yield ie.getLastNotificationClickedForOutcomes(t);return o&&(e.notificationId=o.notificationId),yield ie.upsertSession(e),void(yield Ue.sendOnSessionCallIfNotPlayerCreate(t,i,n,r,e))}if(e.status===j.Active)return void de.debug("Session already active",e);if(!e.lastDeactivatedTimestamp)return void de.debug("Session is in invalid state",e);const c=(new Date).getTime();if(Ue.timeInSecondsBetweenTimestamps(c,e.lastDeactivatedTimestamp)<=o)return e.status=j.Active,e.lastActivatedTimestamp=c,e.lastDeactivatedTimestamp=null,void(yield ie.upsertSession(e));yield Ue.finalizeSession(t,i,n,e,s,a);const d=q({appId:t});yield ie.upsertSession(d),yield Ue.sendOnSessionCallIfNotPlayerCreate(t,i,n,r,d)}))}static deactivateSession(t,i,n,o,s,r){return e(this,void 0,void 0,(function*(){const e=yield ie.getCurrentSession();if(!e)return void de.debug("No active session found. Cannot deactivate.");const a=()=>Ue.finalizeSession(t,i,n,e,s,r);if(e.status===j.Inactive)return le(a,o);if(e.status!==j.Active)return void de.warn(`Session in invalid state ${e.status}. Cannot deactivate.`);const c=(new Date).getTime(),d=Ue.timeInSecondsBetweenTimestamps(c,e.lastActivatedTimestamp);e.lastDeactivatedTimestamp=c,e.accumulatedDuration+=d,e.status=j.Inactive;const u=le(a,o);return yield ie.upsertSession(e),u}))}static sendOnSessionCallIfNotPlayerCreate(t,i,n,o,s){return e(this,void 0,void 0,(function*(){o!==K.PlayerCreate&&(ie.upsertSession(s),ie.resetSentUniqueOutcomes(),yield De.updateUserSession(t,i,n))}))}static finalizeSession(t,i,n,o,s,r){return e(this,void 0,void 0,(function*(){if(de.debug("Finalize session",`started: ${new Date(o.startTimestamp)}`,`duration: ${o.accumulatedDuration}s`),s){de.debug(`send on_focus reporting session duration -> ${o.accumulatedDuration}s`);const e=yield be.getAttribution(r);de.debug("send on_focus with attribution",e),yield De.sendSessionDuration(t,i,n,o.accumulatedDuration,e)}yield Promise.all([ie.cleanupCurrentSession(),ie.removeAllNotificationClickedForOutcomes()]),de.debug("Finalize session finished",`started: ${new Date(o.startTimestamp)}`)}))}static timeInSecondsBetweenTimestamps(e,t){return e<=t?0:Math.floor((e-t)/1e3)}}var We;!function(e){e.OneSignalWorker="OneSignal Worker",e.ThirdParty="3rd Party",e.None="None",e.Indeterminate="Indeterminate"}(We||(We={}));const _e="onesignal-customlink-subscribe",Re="onesignal-customlink-explanation",Fe="onesignal-reset",Ve="hide",Le={subscribed:"state-subscribed",unsubscribed:"state-unsubscribed"},Be={containerSelector:`.${"onesignal-customlink-container"}`,subscribeSelector:`.${_e}`,explanationSelector:`.${Re}`};class $e{constructor(e){this.config=e}initialize(){return e(this,void 0,void 0,(function*(){var e,t;if(!(null===(e=this.config)||void 0===e?void 0:e.enabled))return;if(!(yield this.loadSdkStyles()))return;f.info("OneSignal: initializing customlink");const i=yield OneSignal.context.subscriptionManager.isPushNotificationsEnabled();if((null===(t=this.config)||void 0===t?void 0:t.unsubscribeEnabled)||!i)for(let e=0;e<this.customlinkContainerElements.length;e++)yield this.injectMarkup(this.customlinkContainerElements[e]);else this.hideCustomLinkContainers()}))}injectMarkup(t){return e(this,void 0,void 0,(function*(){t.innerHTML="",yield this.mountExplanationNode(t),yield this.mountSubscriptionNode(t)}))}mountExplanationNode(t){return e(this,void 0,void 0,(function*(){var e;if(null===(e=this.config)||void 0===e?void 0:e.text){if(this.config.text.explanation){const e=document.createElement("p");e.textContent=this.config.text.explanation,ve(e,Fe),ve(e,Re),this.config.size&&ve(e,this.config.size),(yield OneSignal.context.subscriptionManager.isPushNotificationsEnabled())?ve(e,Le.subscribed):ve(e,Le.unsubscribed),t.appendChild(e)}}else f.error("CustomLink: required property 'text' is missing in the config")}))}mountSubscriptionNode(t){return e(this,void 0,void 0,(function*(){var i;if(null===(i=this.config)||void 0===i?void 0:i.text){if(this.config.text.subscribe){const i=document.createElement("button");ve(i,Fe),ve(i,_e),this.config.size&&ve(i,this.config.size),this.config.style&&ve(i,this.config.style),(yield OneSignal.context.subscriptionManager.isPushNotificationsEnabled())?ve(i,Le.subscribed):ve(i,Le.unsubscribed),this.setCustomColors(i),yield this.setTextFromPushStatus(i),i.addEventListener("click",(()=>e(this,void 0,void 0,(function*(){f.info("CustomLink: subscribe clicked"),yield this.handleClick(i)})))),t.appendChild(i)}}else f.error("CustomLink: required property 'text' is missing in the config")}))}loadSdkStyles(){return e(this,void 0,void 0,(function*(){return 0===(yield OneSignal.context.dynamicResourceLoader.loadSdkStylesheet())||(f.debug("Not initializing custom link button because styles failed to load."),!1)}))}hideElement(e){ve(e,Ve)}hideCustomLinkContainers(){this.customlinkContainerElements.forEach((e=>{this.hideElement(e)}))}handleClick(t){return e(this,void 0,void 0,(function*(){var e;if(!OneSignal.User.PushSubscription.optedIn)return yield OneSignal.User.PushSubscription.optIn(),void((null===(e=this.config)||void 0===e?void 0:e.unsubscribeEnabled)||this.hideCustomLinkContainers());yield OneSignal.User.PushSubscription.optOut(),yield this.setTextFromPushStatus(t)}))}setTextFromPushStatus(t){return e(this,void 0,void 0,(function*(){var e,i,n,o;(null===(i=null===(e=this.config)||void 0===e?void 0:e.text)||void 0===i?void 0:i.subscribe)&&((yield OneSignal.context.subscriptionManager.isPushNotificationsEnabled())||(t.textContent=this.config.text.subscribe)),(null===(o=null===(n=this.config)||void 0===n?void 0:n.text)||void 0===o?void 0:o.unsubscribe)&&(yield OneSignal.context.subscriptionManager.isPushNotificationsEnabled())&&(t.textContent=this.config.text.unsubscribe)}))}setCustomColors(e){var t,i,n,o,s,r,a;(null===(t=this.config)||void 0===t?void 0:t.color)&&this.config.color.text&&("button"===(null===(i=this.config)||void 0===i?void 0:i.style)&&(null===(n=this.config)||void 0===n?void 0:n.color.button)?(e.style.backgroundColor=null===(o=this.config)||void 0===o?void 0:o.color.button,e.style.color=null===(s=this.config)||void 0===s?void 0:s.color.text):"link"===(null===(r=this.config)||void 0===r?void 0:r.style)&&(e.style.color=null===(a=this.config)||void 0===a?void 0:a.color.text))}get customlinkContainerElements(){const e=document.querySelectorAll(Be.containerSelector);return Array.prototype.slice.call(e)}}class He{static put(e,t){return void 0===He.store[e]&&(He.store[e]=[null,null]),He.store[e].push(t),He.store[e].length==He.LIMIT+1&&He.store[e].shift(),He.store[e]}static get(e){return void 0===He.store[e]&&(He.store[e]=[null,null]),He.store[e]}static getFirst(e){return He.get(e)[0]}static getLast(e){return He.get(e)[1]}static remove(e){delete He.store[e]}static isEmpty(e){const t=He.get(e);return null===t[0]&&null===t[1]}}He.store={},He.LIMIT=2;const je=class{static decodeHtmlEntities(e){if("undefined"==typeof DOMParser)return e;return(new DOMParser).parseFromString(e,"text/html").documentElement.textContent||""}};var Ke,ze,Ge,qe,Je,Ye;!function(e){e.Native="native",e.Push="push",e.Category="category",e.Sms="sms",e.Email="email",e.SmsAndEmail="smsAndEmail"}(Ke||(Ke={}));class Qe{static isCategorySlidedownConfigured(e){if(!e)return!1;const t=Qe.getFirstSlidedownPromptOptionsWithType(e,Ke.Category);return!!t&&(!!t.categories&&t.categories.length>0)}static isCategorySlidedownConfiguredVersion1(e){var t,i;return((null===(i=null===(t=null==e?void 0:e.categories)||void 0===t?void 0:t.tags)||void 0===i?void 0:i.length)||0)>0}static getFirstSlidedownPromptOptionsWithType(e,t){return e?e.filter((e=>e.type===t))[0]:void 0}static isSlidedownAutoPromptConfigured(e){if(!e)return!1;for(let t=0;t<e.length;t++)if(e[t].autoPrompt)return!0;return!1}static isSlidedownPushDependent(e){return e===Ke.Push||e===Ke.Category}}!function(e){e[e.HttpsPermissionRequest="HTTPS permission request"]="HttpsPermissionRequest",e[e.FullscreenHttpPermissionMessage="fullscreen HTTP permission message"]="FullscreenHttpPermissionMessage",e[e.FullscreenHttpsPermissionMessage="fullscreen HTTPS permission message"]="FullscreenHttpsPermissionMessage",e[e.SlidedownPermissionMessage="slidedown permission message"]="SlidedownPermissionMessage",e[e.SubscriptionBell="subscription bell"]="SubscriptionBell"}(ze||(ze={})),function(e){e[e.MissingAppId=0]="MissingAppId",e[e.RedundantPermissionMessage=1]="RedundantPermissionMessage",e[e.PushPermissionAlreadyGranted=2]="PushPermissionAlreadyGranted",e[e.UnsupportedEnvironment=3]="UnsupportedEnvironment",e[e.MissingDomElement=4]="MissingDomElement",e[e.ServiceWorkerNotActivated=5]="ServiceWorkerNotActivated",e[e.NoProxyFrame=6]="NoProxyFrame"}(Ge||(Ge={}));class InvalidStateError extends a{constructor(e,t){let i;switch(e){case Ge.MissingAppId:i="Missing required app ID.";break;case Ge.RedundantPermissionMessage:{let e="";t&&t.permissionPromptType&&(e=`(${ze[t.permissionPromptType]})`),i=`Another permission message ${e} is being displayed.`;break}case Ge.PushPermissionAlreadyGranted:i="Push permission has already been granted.";break;case Ge.UnsupportedEnvironment:i="The current environment does not support this operation.";break;case Ge.ServiceWorkerNotActivated:i="The service worker must be activated first.";break;case Ge.NoProxyFrame:i="No proxy frame."}super(i),this.description=Ge[e],this.reason=e,Object.setPrototypeOf(this,InvalidStateError.prototype)}}class Xe extends z{constructor(e){super(),this.subscription=e}serialize(){const e=super.serialize();return this.subscription&&(e.identifier=I.useSafariLegacyPush()?this.subscription.safariDeviceToken:this.subscription.w3cEndpoint?this.subscription.w3cEndpoint.toString():null,e.web_auth=this.subscription.w3cAuth,e.web_p256=this.subscription.w3cP256dh),e}static createFromPushSubscription(e,t,i){const n=new Xe(t);return n.appId=e,n.subscriptionState=t?we.Subscribed:we.NotSubscribed,i&&(n.subscriptionState=i),n}deserialize(e){throw new $}}!function(e){e[e.Blocked=0]="Blocked",e[e.Dismissed=1]="Dismissed",e[e.Default=2]="Default"}(qe||(qe={}));class PushPermissionNotGrantedError extends a{constructor(e){let t;switch(e){case qe.Dismissed:t="The user dismissed the permission prompt.";break;case qe.Blocked:t="Notification permissions are blocked.";break;case qe.Default:t="Notification permissions have not been granted yet."}super(t),this.reason=e,Object.setPrototypeOf(this,PushPermissionNotGrantedError.prototype)}}class Ze{static setFromW3cSubscription(e){const t=new Ze;if(e&&(t.w3cEndpoint=new URL(e.endpoint),e.getKey)){let i=null;try{i=e.getKey("p256dh")}catch(e){}let n=null;try{n=e.getKey("auth")}catch(e){}if(i){const e=btoa(String.fromCharCode.apply(null,new Uint8Array(i)));t.w3cP256dh=e}if(n){const e=btoa(String.fromCharCode.apply(null,new Uint8Array(n)));t.w3cAuth=e}}return t}setFromSafariSubscription(e){e&&(this.safariDeviceToken=e)}serialize(){return{w3cEndpoint:this.w3cEndpoint?this.w3cEndpoint.toString():null,w3cP256dh:this.w3cP256dh,w3cAuth:this.w3cAuth,safariDeviceToken:this.safariDeviceToken}}static deserialize(e){const t=new Ze;if(!e)return t;try{t.w3cEndpoint=new URL(e.w3cEndpoint)}catch(e){}return t.w3cP256dh=e.w3cP256dh,t.w3cAuth=e.w3cAuth,t.safariDeviceToken=e.safariDeviceToken,t}}class et{static registerForPush(){return e(this,void 0,void 0,(function*(){return yield et.internalRegisterForPush()}))}static internalRegisterForPush(){return e(this,void 0,void 0,(function*(){const e=OneSignal.context;let t=null;switch(S.getWindowEnv()){case o.Host:case o.OneSignalSubscriptionModal:try{const i=yield e.subscriptionManager.subscribe(0);t=yield e.subscriptionManager.registerSubscription(i),e.pageViewManager.incrementPageViewCount(),yield pe.triggerNotificationPermissionChanged(),yield it.checkAndTriggerSubscriptionChanged()}catch(e){f.error(e)}break;case o.OneSignalSubscriptionPopup:{const t=opener||parent;let i;yield e.permissionManager.updateStoredPermission();try{i=yield e.subscriptionManager.subscribe(1),yield e.permissionManager.updateStoredPermission()}catch(i){if(yield e.permissionManager.updateStoredPermission(),i instanceof PushPermissionNotGrantedError)switch(i.reason){case qe.Blocked:yield e.permissionManager.updateStoredPermission(),OneSignal.subscriptionPopup.message(OneSignal.POSTMAM_COMMANDS.REMOTE_NOTIFICATION_PERMISSION_CHANGED,{permission:x.Denied,forceUpdatePermission:!1});break;case qe.Dismissed:OneSignal.subscriptionPopup.message(OneSignal.POSTMAM_COMMANDS.REMOTE_NOTIFICATION_PERMISSION_CHANGED,{permission:x.Default,forceUpdatePermission:!0})}if(t)return window.close(),null}OneSignal.subscriptionPopup.message(OneSignal.POSTMAM_COMMANDS.FINISH_REMOTE_REGISTRATION,{rawPushSubscription:i.serialize()},(e=>{!0===e.data.progress?(f.debug("Got message from host page that remote reg. is in progress, closing popup."),t&&window.close()):f.debug("Got message from host page that remote reg. could not be finished.")}));break}default:throw new InvalidStateError(Ge.UnsupportedEnvironment)}return t}))}static getRawPushSubscriptionForLegacySafari(e){const t=new Ze,{deviceToken:i}=window.safari.pushNotification.permission(e);return t.setFromSafariSubscription(i),t}static getRawPushSubscriptionFromServiceWorkerRegistration(t){return e(this,void 0,void 0,(function*(){if(!t)return null;const e=yield t.pushManager.getSubscription();return e?Ze.setFromW3cSubscription(e):null}))}static getRawPushSubscriptionWhenUsingSubscriptionWorkaround(){return e(this,void 0,void 0,(function*(){return null}))}static getRawPushSubscription(t,i){return e(this,void 0,void 0,(function*(){if(I.useSafariLegacyPush())return et.getRawPushSubscriptionForLegacySafari(i);if(t.isUsingSubscriptionWorkaround)return et.getRawPushSubscriptionWhenUsingSubscriptionWorkaround();if(t.isBrowserAndSupportsServiceWorkers){const e=yield OneSignal.context.serviceWorkerManager.getRegistration();return yield et.getRawPushSubscriptionFromServiceWorkerRegistration(e)}return null}))}}class tt{static getCurrentNotificationType(){return e(this,void 0,void 0,(function*(){const e=yield OneSignal.context.permissionManager.getNotificationPermission(OneSignal.context.appConfig.safariWebId);if(e===x.Default)return we.NoNativePermission;if(e===x.Denied)return m.isUsingSubscriptionWorkaround()?we.NoNativePermission:we.NotSubscribed;const t=yield OneSignal.context.subscriptionManager.isAlreadyRegisteredWithOneSignal();if(e===x.Granted&&t){return(yield OneSignal.context.subscriptionManager.isPushNotificationsEnabled())?we.Subscribed:we.UserOptedOut}return we.NoNativePermission}))}static markHttpSlidedownShown(){sessionStorage.setItem("ONESIGNAL_HTTP_PROMPT_SHOWN","true")}static isHttpPromptAlreadyShown(){return"true"==sessionStorage.getItem("ONESIGNAL_HTTP_PROMPT_SHOWN")}static checkAndTriggerNotificationPermissionChanged(){return e(this,void 0,void 0,(function*(){const e=yield ie.get("Options","notificationPermission"),t=yield OneSignal.context.permissionManager.getPermissionStatus();e!==t&&(yield pe.triggerNotificationPermissionChanged(),yield ie.put("Options",{key:"notificationPermission",value:t}))}))}static getNotificationIcons(){return e(this,void 0,void 0,(function*(){const e=yield tt.getAppId();if(!e)throw new InvalidStateError(Ge.MissingAppId);const t=`${S.getOneSignalApiUrl().toString()}/apps/${e}/icon`,i=yield fetch(t),n=yield i.json();if(n.errors)throw f.error(`API call ${t}`,"failed with:",n.errors),new Error("Failed to get notification icons.");return n}))}static getSlidedownOptions(e){return p.getValueOrDefault(e.slidedown,{prompts:[]})}static getFullscreenPermissionMessageOptions(e){return e?e.fullscreen?{autoAcceptTitle:e.fullscreen.autoAcceptTitle,actionMessage:e.fullscreen.actionMessage,exampleNotificationTitleDesktop:e.fullscreen.title,exampleNotificationTitleMobile:e.fullscreen.title,exampleNotificationMessageDesktop:e.fullscreen.message,exampleNotificationMessageMobile:e.fullscreen.message,exampleNotificationCaption:e.fullscreen.caption,acceptButton:e.fullscreen.acceptButton,cancelButton:e.fullscreen.cancelButton}:e:null}static getPromptOptionsQueryString(){let e="";if(tt.getFullscreenPermissionMessageOptions(OneSignal.config.userConfig.promptOptions)){const t=tt.getPromptOptionsPostHash();for(const i of Object.keys(t)){e+="&"+i+"="+t[i]}}return e}static getPromptOptionsPostHash(){const e=tt.getFullscreenPermissionMessageOptions(OneSignal.config.userConfig.promptOptions),t={};if(e){const i={exampleNotificationTitleDesktop:"exampleNotificationTitle",exampleNotificationMessageDesktop:"exampleNotificationMessage",exampleNotificationTitleMobile:"exampleNotificationTitle",exampleNotificationMessageMobile:"exampleNotificationMessage"};for(const t of Object.keys(i)){const n=i[t];e[t]&&(e[n]=e[t])}const n=["autoAcceptTitle","siteName","autoAcceptTitle","subscribeText","showGraphic","actionMessage","exampleNotificationTitle","exampleNotificationMessage","exampleNotificationCaption","acceptButton","cancelButton","timeout"];for(let i=0;i<n.length;i++){const o=n[i],s=e[o],r=encodeURIComponent(s);(s||!1===s||""===s)&&(t[o]=r)}}return t}static triggerCustomPromptClicked(e){re.trigger(OneSignal.EVENTS.CUSTOM_PROMPT_CLICKED,{result:e})}static getAppId(){return e(this,void 0,void 0,(function*(){if(OneSignal.config.appId)return Promise.resolve(OneSignal.config.appId);return yield ie.get("Ids","appId")}))}static createDeviceRecord(t,i=!1){return e(this,void 0,void 0,(function*(){let e;if(i){const t=yield et.getRawPushSubscription(OneSignal.environmentInfo,OneSignal.config.safariWebId);t&&(e=t)}const n=new Xe(e);return n.appId=t,n.subscriptionState=yield tt.getCurrentNotificationType(),n}))}static getDeviceId(){return e(this,void 0,void 0,(function*(){return(yield OneSignal.database.getSubscription()).deviceId||void 0}))}static getCurrentPushToken(){return e(this,void 0,void 0,(function*(){var e,t;if(I.useSafariLegacyPush()){const i=null===(t=null===(e=window.safari)||void 0===e?void 0:e.pushNotification)||void 0===t?void 0:t.permission(OneSignal.config.safariWebId).deviceToken;return(null==i?void 0:i.toLowerCase())||void 0}const i=yield OneSignal.context.serviceWorkerManager.getRegistration();if(!i)return;const n=yield i.pushManager.getSubscription();return null==n?void 0:n.endpoint}))}}class it{static onNotificationPermissionChange(){it.checkAndTriggerSubscriptionChanged()}static onInternalSubscriptionSet(t){return e(this,void 0,void 0,(function*(){He.put("subscription.optedOut",t)}))}static checkAndTriggerSubscriptionChanged(){return e(this,void 0,void 0,(function*(){var e;m.logMethodCall("checkAndTriggerSubscriptionChanged");const t=OneSignal.context,i=yield OneSignal.context.subscriptionManager.isPushNotificationsEnabled(),n=yield OneSignal.context.subscriptionManager.isOptedIn(),o=yield ie.getAppState(),{lastKnownPushEnabled:s,lastKnownPushId:r,lastKnownPushToken:a,lastKnownOptedIn:c}=o,d=yield tt.getCurrentPushToken(),u=yield OneSignal.coreDirector.getPushSubscriptionModel(),l=null===(e=null==u?void 0:u.data)||void 0===e?void 0:e.id;if(!(null===s||i!==s||d!==a||l!==r))return;yield t.subscriptionManager.updateNotificationTypes(),o.lastKnownPushEnabled=i,o.lastKnownPushToken=d,o.lastKnownPushId=l,o.lastKnownOptedIn=n,yield ie.setAppState(o);const g={previous:{id:r,token:a,optedIn:null==c||c},current:{id:l,token:d,optedIn:n}};f.info("Push Subscription state changed: ",g),it.triggerSubscriptionChanged(g)}))}static _onSubscriptionChanged(t){return e(this,void 0,void 0,(function*(){var e,i,n;it.onSubscriptionChanged_showWelcomeNotification(null===(e=null==t?void 0:t.current)||void 0===e?void 0:e.optedIn,null===(i=null==t?void 0:t.current)||void 0===i?void 0:i.id),it.onSubscriptionChanged_sendCategorySlidedownTags(null===(n=null==t?void 0:t.current)||void 0===n?void 0:n.optedIn),it.onSubscriptionChanged_evaluateNotifyButtonDisplayPredicate(),it.onSubscriptionChanged_updateCustomLink()}))}static onSubscriptionChanged_sendCategorySlidedownTags(t){return e(this,void 0,void 0,(function*(){var e,i;if(!0!==t)return;const n=null===(i=null===(e=OneSignal.context.appConfig.userConfig.promptOptions)||void 0===e?void 0:e.slidedown)||void 0===i?void 0:i.prompts;Qe.isCategorySlidedownConfigured(n)&&(yield OneSignal.context.tagManager.sendTags())}))}static onSubscriptionChanged_showWelcomeNotification(t,i){return e(this,void 0,void 0,(function*(){var e;if(OneSignal.__doNotShowWelcomeNotification)return void f.debug("Not showing welcome notification because user has previously subscribed.");const n=null===(e=OneSignal.config)||void 0===e?void 0:e.userConfig.welcomeNotification;if(void 0!==n&&!0===n.disable)return;if(!0!==t)return;if(!i)return;const{appId:o}=yield ie.getAppConfig();let s=void 0!==n&&void 0!==n.title&&null!==n.title?n.title:"",r=void 0!==n&&void 0!==n.message&&null!==n.message&&n.message.length>0?n.message:"Thanks for subscribing!";const a=new URL(location.href).origin+"?_osp=do_not_open",c=n&&n.url&&n.url.length>0?n.url:a;s=je.decodeHtmlEntities(s),r=je.decodeHtmlEntities(r),f.debug("Sending welcome notification."),Me.sendNotification(o,[i],{en:s},{en:r},c,null,{__isOneSignalWelcomeNotification:!0},void 0),re.trigger(OneSignal.EVENTS.WELCOME_NOTIFICATION_SENT,{title:s,message:r,url:c})}))}static onSubscriptionChanged_evaluateNotifyButtonDisplayPredicate(){return e(this,void 0,void 0,(function*(){if(!OneSignal.config.userConfig.notifyButton)return;const e=OneSignal.config.userConfig.notifyButton.displayPredicate;if(e&&"function"==typeof e&&OneSignal.notifyButton){!1!==(yield e())?(f.debug("Showing notify button because display predicate returned true."),OneSignal.notifyButton.launcher.show()):(f.debug("Hiding notify button because display predicate returned false."),OneSignal.notifyButton.launcher.hide())}}))}static onSubscriptionChanged_updateCustomLink(){return e(this,void 0,void 0,(function*(){OneSignal.config.userConfig.promptOptions&&new $e(OneSignal.config.userConfig.promptOptions.customlink).initialize()}))}static triggerSubscriptionChanged(e){re.trigger(OneSignal.EVENTS.SUBSCRIPTION_CHANGED,e)}static triggerNotificationClick(e){const t={notification:e.notification,result:e.result};return re.trigger(OneSignal.EVENTS.NOTIFICATION_CLICKED,t)}static fireStoredNotificationClicks(){return e(this,void 0,void 0,(function*(){yield fe();const t=OneSignal.config.pageUrl||OneSignal.config.userConfig.pageUrl||document.URL;function i(t){return e(this,void 0,void 0,(function*(){const e=yield ie.getAppState();e.pendingNotificationClickEvents[t.result.url]=null,yield ie.setAppState(e);const i=t.timestamp;if(i){if((Date.now()-i)/1e3/60>5)return}it.triggerNotificationClick(t)}))}const n=yield ie.getAppState();if("origin"===(yield ie.get("Options","notificationClickHandlerMatch"))){for(const e of Object.keys(n.pendingNotificationClickEvents))if(new URL(e).origin===location.origin){const t=n.pendingNotificationClickEvents[e];yield i(t)}}else{let e=n.pendingNotificationClickEvents[t];if(e)yield i(e);else if(!e&&t.endsWith("/")){const o=t.substring(0,t.length-1);e=n.pendingNotificationClickEvents[o],e&&(yield i(e))}}}))}}class nt{constructor(e,t){this.context=e,this.config=t}getRegistration(){return e(this,void 0,void 0,(function*(){return yield P.getRegistration(this.config.registrationOptions.scope)}))}getActiveState(){return e(this,void 0,void 0,(function*(){const e=yield S.getIntegration();if(e===r.InsecureProxy)return We.Indeterminate;if(e===r.SecureProxy){switch(S.getWindowEnv()){case o.Host:case o.CustomIframe:{const e=OneSignal.proxyFrameHost;return e?yield e.runCommand(OneSignal.POSTMAM_COMMANDS.SERVICE_WORKER_STATE):We.Indeterminate}case o.OneSignalSubscriptionPopup:break;case o.OneSignalSubscriptionModal:throw new $}}const t=yield this.context.serviceWorkerManager.getRegistration();if(!t)return We.None;const i=nt.activeSwFileName(t);return this.swActiveStateByFileName(i)}))}static activeSwFileName(e){const t=P.getAvailableServiceWorker(e);if(!t)return null;const i=new URL(t.scriptURL).pathname,n=new U(i).getFileName();if("akam-sw.js"==n){const e=new URLSearchParams(new URL(t.scriptURL).search).get("othersw");if(e)return f.debug("Found a ServiceWorker under Akamai's akam-sw.js?othersw=",e),new U(new URL(e).pathname).getFileName()}return n}swActiveStateByFileName(e){if(!e)return We.None;return e==this.config.workerPath.getFileName()||"OneSignalSDK.sw.js"==e?We.OneSignalWorker:We.ThirdParty}getWorkerVersion(){return e(this,void 0,void 0,(function*(){return new Promise((t=>e(this,void 0,void 0,(function*(){if(m.isUsingSubscriptionWorkaround()){const e=OneSignal.proxyFrameHost;if(e){const i=yield e.runCommand(OneSignal.POSTMAM_COMMANDS.GET_WORKER_VERSION);t(i)}else t(NaN)}else this.context.workerMessenger.once(k.WorkerVersion,(e=>{t(e)})),yield this.context.workerMessenger.unicast(k.WorkerVersion)}))))}))}shouldInstallWorker(){return e(this,void 0,void 0,(function*(){if(!I.supportsServiceWorkers())return!1;if(!OneSignal.config)return!1;if(OneSignal.config.subdomain&&"safari"!==OneSignal.environmentInfo.browserType&&S.getWindowEnv()===o.Host)return!1;const e=yield this.getActiveState();if(f.debug("[shouldInstallWorker] workerState",e),e===We.None||e===We.ThirdParty){const e="granted"===(yield OneSignal.context.permissionManager.getNotificationPermission(OneSignal.config.safariWebId));return e&&f.info("[shouldInstallWorker] Notification Permissions enabled, will install ServiceWorker"),e}return!!(yield this.haveParamsChanged())||this.workerNeedsUpdate()}))}haveParamsChanged(){return e(this,void 0,void 0,(function*(){const e=yield this.context.serviceWorkerManager.getRegistration();if(!e)return f.info("[changedServiceWorkerParams] workerRegistration not found at scope",this.config.registrationOptions.scope),!0;const t=new URL(e.scope).pathname,i=this.config.registrationOptions.scope;if(t!=i)return f.info("[changedServiceWorkerParams] ServiceWorker scope changing",{a_old:t,b_new:i}),!0;const n=P.getAvailableServiceWorker(e),o=Ue.getServiceWorkerHref(this.config,this.context.appConfig.appId,I.version());return!(null==n?void 0:n.scriptURL)||o!==n.scriptURL&&(f.info("[changedServiceWorkerParams] ServiceWorker href changing:",{a_old:null==n?void 0:n.scriptURL,b_new:o}),!0)}))}workerNeedsUpdate(){return e(this,void 0,void 0,(function*(){let e;f.info("[Service Worker Update] Checking service worker version...");try{e=yield g.timeoutPromise(this.getWorkerVersion(),2e3)}catch(e){return f.info("[Service Worker Update] Worker did not reply to version query; assuming older version and updating."),!0}return e!==I.version()?(f.info(`[Service Worker Update] Updating service worker from ${e} --\x3e ${I.version()}.`),!0):(f.info(`[Service Worker Update] Service worker version is current at ${e} (no update required).`),!1)}))}establishServiceWorkerChannel(){return e(this,void 0,void 0,(function*(){f.debug("establishServiceWorkerChannel");const t=this.context.workerMessenger;t.off(),t.on(k.NotificationWillDisplay,(t=>e(this,void 0,void 0,(function*(){f.debug(location.origin,"Received notification display event from service worker.");const e={notification:t.notification,preventDefault:function(){throw new Error("Browser does not support preventing display.")}};yield re.trigger(OneSignal.EVENTS.NOTIFICATION_WILL_DISPLAY,e)})))),t.on(k.NotificationClicked,(t=>e(this,void 0,void 0,(function*(){let e;if(e=S.getWindowEnv()===o.OneSignalProxyFrame?yield new Promise((e=>{const t=OneSignal.proxyFrame;t&&t.messenger.message(OneSignal.POSTMAM_COMMANDS.GET_EVENT_LISTENER_COUNT,OneSignal.EVENTS.NOTIFICATION_CLICKED,(t=>{const i=t.data;e(i)}))})):OneSignal.emitter.numberOfListeners(OneSignal.EVENTS.NOTIFICATION_CLICKED),0===e){f.debug("notification.clicked event received, but no event listeners; storing event in IndexedDb for later retrieval.");let e=t.result.url;e||(e=location.href),yield ie.putNotificationClickedEventPendingUrlOpening(t)}else yield it.triggerNotificationClick(t)})))),t.on(k.RedirectPage,(e=>{f.debug(`${S.getWindowEnv().toString()} Picked up command.redirect to ${e}, forwarding to host page.`);const t=OneSignal.proxyFrame;t&&t.messenger.message(OneSignal.POSTMAM_COMMANDS.SERVICEWORKER_COMMAND_REDIRECT,e)})),t.on(k.NotificationDismissed,(t=>e(this,void 0,void 0,(function*(){yield re.trigger(OneSignal.EVENTS.NOTIFICATION_DISMISSED,t)}))));const i=m.isHttps(),n=m.isSafari();t.on(k.AreYouVisible,(o=>e(this,void 0,void 0,(function*(){if(i&&n){const e={timestamp:o.timestamp,focused:document.hasFocus()};yield t.directPostMessageToSW(k.AreYouVisibleResponse,e)}else{const e={timestamp:o.timestamp},t=OneSignal.proxyFrame;t&&t.messenger.message(OneSignal.POSTMAM_COMMANDS.ARE_YOU_VISIBLE_REQUEST,e)}}))))}))}installWorker(){return e(this,void 0,void 0,(function*(){if(!(yield this.shouldInstallWorker()))return this.getRegistration();f.info("Installing worker...");(yield this.getActiveState())===We.ThirdParty&&f.info("[Service Worker Installation] 3rd party service worker detected.");const e=Ue.getServiceWorkerHref(this.config,this.context.appConfig.appId,I.version()),t=`${m.getBaseUrl()}${this.config.registrationOptions.scope}`;let i;f.info(`[Service Worker Installation] Installing service worker ${e} ${t}.`);try{i=yield navigator.serviceWorker.register(e,{scope:t})}catch(e){f.error(`[Service Worker Installation] Installing service worker failed ${e}`);if(S.getWindowEnv()===o.OneSignalSubscriptionPopup)throw e;i=yield this.fallbackToUserModelBetaWorker()}return f.debug("[Service Worker Installation] Service worker installed. Waiting for activation"),yield P.waitUntilActive(i),f.debug("[Service Worker Installation] Service worker active"),yield this.establishServiceWorkerChannel(),i}))}fallbackToUserModelBetaWorker(){return e(this,void 0,void 0,(function*(){const e="OneSignalSDK.sw.js",t={workerPath:new U(`/${e}`),registrationOptions:this.config.registrationOptions},i=Ue.getServiceWorkerHref(t,this.context.appConfig.appId,I.version()),n=`${m.getBaseUrl()}${this.config.registrationOptions.scope}`;f.info(`[Service Worker Installation] Attempting to install v16 Beta Worker ${i} ${n}.`);try{const t=yield navigator.serviceWorker.register(i,{scope:n}),o=`\n        [Service Worker Installation] Successfully installed v16 Beta Worker.\n        Deprecation warning: support for the v16 beta worker name of ${e}\n        will be removed May 5 2024. We have decided to keep the v15 name.\n        To avoid breaking changes for your users, please host both worker files:\n        OneSignalSDK.sw.js & OneSignalSDKWorker.js.\n      `;return f.error(o),t}catch(e){const t=yield fetch(i);if(403===t.status||404===t.status)throw new ce(t.status,t.statusText);throw e}}))}}!function(e){e[e.InvalidSafariSetup=0]="InvalidSafariSetup",e[e.Blocked=1]="Blocked",e[e.Dismissed=2]="Dismissed"}(Je||(Je={}));class ot extends a{constructor(e){let t;switch(e){case Je.InvalidSafariSetup:t="The Safari site URL, icon size, or push certificate is invalid, or Safari is in a private session.";break;case Je.Blocked:t="Notification permissions are blocked.";break;case Je.Dismissed:t="The notification permission prompt was dismissed."}super(t),Object.setPrototypeOf(this,ot.prototype)}}class st{constructor(e,t,i,n){this.model=e,this.property=t,this.oldValue=i,this.newValue=n}}class rt{constructor(){this.subscribers=new Set}subscribe(e){return this.subscribers.add(e),()=>this.subscribers.delete(e)}broadcast(e){this.subscribers.forEach((t=>{t(e)}))}}!function(e){e.Add="add",e.Remove="remove",e.Update="update",e.Hydrate="hydrate"}(Ye||(Ye={}));class at{constructor(e,t){this.modelId=e,this.payload=t,this.type=Ye.Update}}class ct{constructor(e,t){this.modelId=e,this.payload=t,this.type=Ye.Hydrate}}class dt extends rt{constructor(e,t,i){super(),this.modelName=e,this.modelId=null!=i?i:Math.random().toString(36).substring(2),this.modelName=e,this.data=t,this.onesignalId=void 0,this.awaitOneSignalIdAvailable=new Promise((e=>{this.onesignalIdAvailableCallback=e}))}setOneSignalId(e){var t;he("setOneSignalId",{onesignalId:e}),this.onesignalId=e,e&&(null===(t=this.onesignalIdAvailableCallback)||void 0===t||t.call(this,e))}set(e,t,i=!0){let n;if(he("set",{property:e,newValue:t}),this.data&&(n=this.data[e],this.data[e]=t),i){const i=new at(this.modelId,new st(this,e,n,t));this.broadcast(i)}}hydrate(e){he("hydrate",{data:e}),this.data=e,this.broadcast(new ct(this.modelId,this))}encode(){const e=this.modelId,t=this.modelName,i=this.onesignalId;return Object.assign({modelId:e,modelName:t,onesignalId:i},this.data)}static decode(e){he("decode",{encodedModel:e});const{modelId:t,modelName:i,onesignalId:n}=e,o=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]])}return i}(e,["modelId","modelName","onesignalId"]),s=new dt(i,o,t);return s.setOneSignalId(n),s}}class ut{constructor(){this.hasOneSignalId=!1,this.isCreatingUser=!1}static createOrGetInstance(){return ut.singletonInstance||(ut.singletonInstance=new ut,lt.initializeUser(!0).then((()=>{lt.copyOneSignalIdPromiseFromIdentityModel().catch((e=>{console.error(e)}))})).catch((e=>{console.error(e)}))),ut.singletonInstance}addAlias(e,t){if(he("addAlias",{label:e,id:t}),"string"!=typeof e)throw new InvalidArgumentError("label",s.WrongType);if("string"!=typeof t)throw new InvalidArgumentError("id",s.WrongType);if(!e)throw new InvalidArgumentError("label",s.Empty);if(!t)throw new InvalidArgumentError("id",s.Empty);this.addAliases({[e]:t})}addAliases(t){if(he("addAliases",{aliases:t}),!t||0===Object.keys(t).length)throw new InvalidArgumentError("aliases",s.Empty);Object.keys(t).forEach((t=>e(this,void 0,void 0,(function*(){if("string"!=typeof t)throw new InvalidArgumentError("label",s.WrongType)})))),Object.keys(t).forEach((i=>e(this,void 0,void 0,(function*(){const e=OneSignal.coreDirector.getIdentityModel();null==e||e.set(i,t[i])}))))}removeAlias(e){if(he("removeAlias",{label:e}),"string"!=typeof e)throw new InvalidArgumentError("label",s.WrongType);if(!e)throw new InvalidArgumentError("label",s.Empty);this.removeAliases([e])}removeAliases(t){if(he("removeAliases",{aliases:t}),!t||0===t.length)throw new InvalidArgumentError("aliases",s.Empty);t.forEach((t=>e(this,void 0,void 0,(function*(){const e=OneSignal.coreDirector.getIdentityModel();null==e||e.set(t,void 0)}))))}addEmail(t){return e(this,void 0,void 0,(function*(){var e,i,n;if(he("addEmail",{email:t}),"string"!=typeof t)throw new InvalidArgumentError("email",s.WrongType);if(!t)throw new InvalidArgumentError("email",s.Empty);if(!function(e){return!!e&&!!e.match(/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/)}(t))throw new InvalidArgumentError("email",s.Malformed);const o={type:Se.Email,token:t},r=new dt(_.EmailSubscriptions,o);(null===(e=ut.singletonInstance)||void 0===e?void 0:e.isCreatingUser)||(null===(i=ut.singletonInstance)||void 0===i?void 0:i.hasOneSignalId)?(r.setOneSignalId(null===(n=ut.singletonInstance)||void 0===n?void 0:n.onesignalId),OneSignal.coreDirector.add(_.EmailSubscriptions,r,!0)):(OneSignal.coreDirector.add(_.EmailSubscriptions,r,!1),yield lt.createAndHydrateUser()),lt.updateModelWithCurrentUserOneSignalId(r).catch((e=>{throw e}))}))}addSms(t){return e(this,void 0,void 0,(function*(){var e,i,n;if(he("addSms",{sms:t}),"string"!=typeof t)throw new InvalidArgumentError("sms",s.WrongType);if(!t)throw new InvalidArgumentError("sms",s.Empty);const o={type:Se.SMS,token:t},r=new dt(_.SmsSubscriptions,o);(null===(e=ut.singletonInstance)||void 0===e?void 0:e.isCreatingUser)||(null===(i=ut.singletonInstance)||void 0===i?void 0:i.hasOneSignalId)?(r.setOneSignalId(null===(n=ut.singletonInstance)||void 0===n?void 0:n.onesignalId),OneSignal.coreDirector.add(_.SmsSubscriptions,r,!0)):(OneSignal.coreDirector.add(_.SmsSubscriptions,r,!1),yield lt.createAndHydrateUser()),lt.updateModelWithCurrentUserOneSignalId(r).catch((e=>{throw e}))}))}removeEmail(t){if(he("removeEmail",{email:t}),"string"!=typeof t)throw new InvalidArgumentError("email",s.WrongType);if(!t)throw new InvalidArgumentError("email",s.Empty);const i=OneSignal.coreDirector.getEmailSubscriptionModels();Object.keys(i).forEach((n=>e(this,void 0,void 0,(function*(){var e;(null===(e=i[n].data)||void 0===e?void 0:e.token)===t&&OneSignal.coreDirector.remove(_.EmailSubscriptions,n)}))))}removeSms(t){if(he("removeSms",{smsNumber:t}),"string"!=typeof t)throw new InvalidArgumentError("smsNumber",s.WrongType);if(!t)throw new InvalidArgumentError("smsNumber",s.Empty);const i=OneSignal.coreDirector.getSmsSubscriptionModels();Object.keys(i).forEach((n=>e(this,void 0,void 0,(function*(){var e;(null===(e=i[n].data)||void 0===e?void 0:e.token)===t&&OneSignal.coreDirector.remove(_.SmsSubscriptions,n)}))))}addTag(e,t){if(he("addTag",{key:e,value:t}),"string"!=typeof e)throw new InvalidArgumentError("key",s.WrongType);if("string"!=typeof t)throw new InvalidArgumentError("value",s.WrongType);if(!e)throw new InvalidArgumentError("key",s.Empty);if(!t)throw new InvalidArgumentError("value",s.Empty,"Did you mean to call removeTag?");this.addTags({[e]:t})}addTags(e){var t;if(he("addTags",{tags:e}),"object"!=typeof e)throw new InvalidArgumentError("tags",s.WrongType);if(!e)throw new InvalidArgumentError("tags",s.Empty);const i=OneSignal.coreDirector.getPropertiesModel();e=Object.assign(Object.assign({},null===(t=null==i?void 0:i.data)||void 0===t?void 0:t.tags),e),null==i||i.set("tags",e)}removeTag(e){if(he("removeTag",{tagKey:e}),"string"!=typeof e)throw new InvalidArgumentError("tagKey",s.WrongType);if(void 0===e)throw new InvalidArgumentError("tagKey",s.Empty);this.removeTags([e])}removeTags(e){var t;if(he("removeTags",{tagKeys:e}),!e||0===e.length)throw new InvalidArgumentError("tagKeys",s.Empty);const i=OneSignal.coreDirector.getPropertiesModel(),n=JSON.parse(JSON.stringify(null===(t=null==i?void 0:i.data)||void 0===t?void 0:t.tags));n&&(e.forEach((e=>{n[e]=""})),null==i||i.set("tags",n))}getTags(){var e,t;return he("getTags"),null===(t=null===(e=OneSignal.coreDirector.getPropertiesModel())||void 0===e?void 0:e.data)||void 0===t?void 0:t.tags}}ut.singletonInstance=void 0;class lt{static initializeUser(t){return e(this,void 0,void 0,(function*(){he("initializeUser",{isTemporary:t});const e=OneSignal.coreDirector.getIdentityModel(),i=OneSignal.coreDirector.getPropertiesModel();!e||!i?(lt.createUserPropertiesModel(),yield lt.createAnonymousUser(t)):f.debug("User already exists, skipping initialization.")}))}static resetUserMetaProperties(){const e=ut.createOrGetInstance();e.hasOneSignalId=!1,e.awaitOneSignalIdAvailable=void 0,e.isCreatingUser=!1}static createAnonymousUser(t){return e(this,void 0,void 0,(function*(){let e;if(t)e={};else{const t=yield lt.createUserOnServer();if(!t)return;e=t.identity,OneSignal.coreDirector.hydrateUser(t)}const i=new dt(_.Identity,e);i.setOneSignalId(e.onesignal_id),OneSignal.coreDirector.add(_.Identity,i,!1),yield this.copyOneSignalIdPromiseFromIdentityModel()}))}static createUserPropertiesModel(){const e={language:I.getLanguage(),timezone_id:Intl.DateTimeFormat().resolvedOptions().timeZone},t=new dt(_.Properties,e);return OneSignal.coreDirector.add(_.Properties,t,!1),t}static createUserOnServer(){return e(this,void 0,void 0,(function*(){const e=ut.createOrGetInstance();if(!e.isCreatingUser){e.isCreatingUser=!0;try{const t=yield tt.getAppId(),i=yield lt.getAllUserData(),n=yield Te.createUser({appId:t},i);return e.isCreatingUser=!1,n.result}catch(e){f.error(e)}}}))}static createAndHydrateUser(){return e(this,void 0,void 0,(function*(){const e=yield lt.createUserOnServer();e&&OneSignal.coreDirector.hydrateUser(e)}))}static getAllUserData(){return e(this,void 0,void 0,(function*(){he("LoginManager.getAllUserData");const e=OneSignal.coreDirector.getIdentityModel(),t=OneSignal.coreDirector.getPropertiesModel(),i=yield OneSignal.coreDirector.getAllSubscriptionsModels(),n={};return n.identity=null==e?void 0:e.data,n.properties=null==t?void 0:t.data,n.subscriptions=null==i?void 0:i.map((e=>e.data)),n}))}static copyOneSignalIdPromiseFromIdentityModel(){return e(this,void 0,void 0,(function*(){var e;const t=ut.createOrGetInstance(),i=OneSignal.coreDirector.getIdentityModel();t.awaitOneSignalIdAvailable=null==i?void 0:i.awaitOneSignalIdAvailable,null===(e=t.awaitOneSignalIdAvailable)||void 0===e||e.then((e=>{t.hasOneSignalId=!0,t.onesignalId=e}))}))}static updateModelWithCurrentUserOneSignalId(t){return e(this,void 0,void 0,(function*(){const e=ut.createOrGetInstance();yield e.awaitOneSignalIdAvailable,t.setOneSignalId(e.onesignalId)}))}}function gt(e){return void 0!==(null==e?void 0:e.type)&&void 0!==(null==e?void 0:e.id)}class pt{constructor(e,t){this.safariPermissionPromptFailed=!1,this.context=e,this.config=t}isPushNotificationsEnabled(){return e(this,void 0,void 0,(function*(){const e=yield this.getSubscriptionState();return e.subscribed&&!e.optedOut}))}isOptedIn(){return e(this,void 0,void 0,(function*(){const e=yield this.getSubscriptionState();return"granted"===(yield OneSignal.context.permissionManager.getPermissionStatus())&&!e.optedOut}))}isOptedOut(t){return e(this,void 0,void 0,(function*(){he("isOptedOut",t);const{optedOut:e}=yield ie.getSubscription();return function(e,...t){if(e)e.apply(null,t)}(t,e),e}))}subscribe(t){return e(this,void 0,void 0,(function*(){const e=S.getWindowEnv();switch(e){case o.CustomIframe:case o.Unknown:case o.OneSignalProxyFrame:throw new InvalidStateError(Ge.UnsupportedEnvironment)}let i;switch(e){case o.ServiceWorker:i=yield this.subscribeFcmFromWorker(t);break;case o.Host:case o.OneSignalSubscriptionModal:case o.OneSignalSubscriptionPopup:if((yield OneSignal.context.permissionManager.getPermissionStatus())===x.Denied)throw new PushPermissionNotGrantedError(qe.Blocked);if(I.useSafariLegacyPush()){i=yield this.subscribeSafari(),yield this._updatePushSubscriptionModelWithRawSubscription(i),f.info("Installing SW on Safari");try{yield this.context.serviceWorkerManager.installWorker(),f.info("SW on Safari successfully installed")}catch(e){f.error("SW on Safari failed to install.")}}else i=yield this.subscribeFcmFromPage(t),yield this._updatePushSubscriptionModelWithRawSubscription(i);break;default:throw new InvalidStateError(Ge.UnsupportedEnvironment)}return i}))}_updatePushSubscriptionModelWithRawSubscription(t){return e(this,void 0,void 0,(function*(){const e=yield OneSignal.coreDirector.getPushSubscriptionModel();if(!e)return OneSignal.coreDirector.generatePushSubscriptionModel(t),void(yield lt.createAndHydrateUser());{const i=new Ie(t).serialize(),n=Object.keys(i);for(let t=0;t<n.length;t++){const o=n[t];i[o]&&e.set(o,i[o])}}}))}updateNotificationTypes(){return e(this,void 0,void 0,(function*(){const e=yield this.getNotificationTypes();yield this.updatePushSubscriptionNotificationTypes(e)}))}getNotificationTypes(){return e(this,void 0,void 0,(function*(){const{optedOut:e}=yield ie.getSubscription();if(e)return we.UserOptedOut;return"granted"===(yield OneSignal.context.permissionManager.getPermissionStatus())?we.Subscribed:we.NoNativePermission}))}updatePushSubscriptionNotificationTypes(t){return e(this,void 0,void 0,(function*(){const e=yield OneSignal.coreDirector.getPushSubscriptionModel();e?(e.set("notification_types",t),e.set("enabled",t===we.Subscribed)):f.info("No Push Subscription yet to update notification_types.")}))}registerSubscription(t,i){return e(this,void 0,void 0,(function*(){t&&(t=Ze.deserialize(t)),(yield this.isAlreadyRegisteredWithOneSignal())?yield this.context.updateManager.sendPushDeviceRecordUpdate():this.context.sessionManager.upsertSession(K.PlayerCreate);const e=yield ie.getSubscription();return e.deviceId="99999999-9999-9999-9999-999999999999",e.optedOut=!1,t?I.useSafariLegacyPush()?e.subscriptionToken=t.safariDeviceToken:e.subscriptionToken=t.w3cEndpoint?t.w3cEndpoint.toString():null:e.subscriptionToken=null,yield ie.setSubscription(e),S.getWindowEnv()!==o.ServiceWorker&&re.trigger(OneSignal.EVENTS.REGISTERED),"undefined"!=typeof OneSignal&&(OneSignal._sessionInitAlreadyRunning=!1),e}))}static requestPresubscribeNotificationPermission(){return e(this,void 0,void 0,(function*(){return yield pt.requestNotificationPermission()}))}unsubscribe(t){return e(this,void 0,void 0,(function*(){if(0===t)throw new $;if(1!==t)throw new $;if(S.getWindowEnv()!==o.ServiceWorker)throw new $;yield ie.put("Options",{key:"optedOut",value:!0})}))}static requestNotificationPermission(){return e(this,void 0,void 0,(function*(){const e=yield window.Notification.requestPermission();return x[e]}))}associateSubscriptionWithEmail(t){return e(this,void 0,void 0,(function*(){const e=yield ie.getEmailProfile();e.subscriptionId&&(yield Me.updatePlayer(this.config.appId,t,{parent_player_id:e.subscriptionId,email:e.identifier}))}))}isAlreadyRegisteredWithOneSignal(){return e(this,void 0,void 0,(function*(){const{deviceId:e}=yield ie.getSubscription();return!!e}))}subscribeSafariPromptPermission(){return e(this,void 0,void 0,(function*(){const e=e=>new Promise((t=>{window.safari.pushNotification.requestPermission(e,this.config.safariWebId,{app_id:this.config.appId},(e=>{e&&e.deviceToken?t(e.deviceToken.toLowerCase()):t(null)}))}));return this.safariPermissionPromptFailed?e(`${S.getOneSignalApiUrl().toString()}/safari`):e(`${S.getOneSignalApiUrl().toString()}/safari/apps/${this.config.appId}`)}))}subscribeSafari(){return e(this,void 0,void 0,(function*(){const e=new Ze;if(!this.config.safariWebId)throw new SdkInitError(Ae.MissingSafariWebId);const{deviceToken:t}=window.safari.pushNotification.permission(this.config.safariWebId);if(t)return e.setFromSafariSubscription(t.toLowerCase()),e;re.trigger(OneSignal.EVENTS.PERMISSION_PROMPT_DISPLAYED);const i=yield this.subscribeSafariPromptPermission();if(pe.triggerNotificationPermissionChanged(),!i)throw this.safariPermissionPromptFailed=!0,new ot(Je.InvalidSafariSetup);return e.setFromSafariSubscription(i),e}))}subscribeFcmFromPage(t){return e(this,void 0,void 0,(function*(){if(S.getWindowEnv()!==o.ServiceWorker&&Notification.permission===x.Default){yield re.trigger(OneSignal.EVENTS.PERMISSION_PROMPT_DISPLAYED);const e=yield pt.requestPresubscribeNotificationPermission(),t=e===x.Default;switch(yield pe.triggerNotificationPermissionChanged(t),e){case x.Default:throw f.debug("Exiting subscription and not registering worker because the permission was dismissed."),OneSignal._sessionInitAlreadyRunning=!1,new PushPermissionNotGrantedError(qe.Dismissed);case x.Denied:throw f.debug("Exiting subscription and not registering worker because the permission was blocked."),OneSignal._sessionInitAlreadyRunning=!1,new PushPermissionNotGrantedError(qe.Blocked)}}let e;try{e=yield this.context.serviceWorkerManager.installWorker()}catch(e){throw e instanceof ce&&(403===e.status?yield this.context.subscriptionManager.registerFailedSubscription(we.ServiceWorkerStatus403,this.context):404===e.status&&(yield this.context.subscriptionManager.registerFailedSubscription(we.ServiceWorkerStatus404,this.context))),e}if(!e)throw new Error("OneSignal service worker not found!");return f.debug("[Subscription Manager] Service worker is ready to continue subscribing."),yield this.subscribeWithVapidKey(e.pushManager,t)}))}subscribeFcmFromWorker(t){return e(this,void 0,void 0,(function*(){const e=self.registration;if(!e.active&&"firefox"!==h().name)throw new InvalidStateError(Ge.ServiceWorkerNotActivated);const i=yield e.pushManager.permissionState({userVisibleOnly:!0});if("denied"===i)throw new PushPermissionNotGrantedError(qe.Blocked);if("prompt"===i)throw new PushPermissionNotGrantedError(qe.Default);return yield this.subscribeWithVapidKey(e.pushManager,t)}))}getVapidKeyForBrowser(){let e;return e="firefox"===h().name?this.config.onesignalVapidPublicKey:this.config.vapidPublicKey,e?function(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),i=atob(t),n=new Uint8Array(i.length);for(let e=0;e<i.length;++e)n[e]=i.charCodeAt(e);return n}(e).buffer:void 0}subscribeWithVapidKey(t,i){return e(this,void 0,void 0,(function*(){const e=yield t.getSubscription();switch(i){case 0:if(!e)break;e.options?f.debug("[Subscription Manager] An existing push subscription exists and it's options is not null."):(f.debug("[Subscription Manager] An existing push subscription exists and options is null. Unsubscribing from push first now."),yield pt.doPushUnsubscribe(e));break;case 1:e&&(yield pt.doPushUnsubscribe(e))}const[n,o]=yield pt.doPushSubscribe(t,this.getVapidKeyForBrowser());yield pt.updateSubscriptionTime(o,n.expirationTime);return Ze.setFromW3cSubscription(n)}))}static updateSubscriptionTime(t,i){return e(this,void 0,void 0,(function*(){const e=yield ie.getSubscription();t&&(e.createdAt=(new Date).getTime()),e.expirationTime=i,yield ie.setSubscription(e)}))}static doPushUnsubscribe(t){return e(this,void 0,void 0,(function*(){f.debug("[Subscription Manager] Unsubscribing existing push subscription.");const e=yield t.unsubscribe();return f.debug(`[Subscription Manager] Unsubscribing existing push subscription result: ${e}`),e}))}static doPushSubscribe(t,i){return e(this,void 0,void 0,(function*(){if(!i)throw new Error("Missing required 'applicationServerKey' to subscribe for push notifications!");const e={userVisibleOnly:!0,applicationServerKey:i};f.debug("[Subscription Manager] Subscribing to web push with these options:",e);try{const i=yield t.getSubscription();return[yield t.subscribe(e),!i]}catch(i){if("InvalidStateError"==i.name){f.warn("[Subscription Manager] Couldn't re-subscribe due to applicationServerKey changing, unsubscribe and attempting to subscribe with new key.",i);const n=yield t.getSubscription();return n&&(yield pt.doPushUnsubscribe(n)),[yield t.subscribe(e),!0]}throw i}}))}isSubscriptionExpiring(){return e(this,void 0,void 0,(function*(){const e=yield S.getIntegration(),t=S.getWindowEnv();switch(e){case r.Secure:return yield this.isSubscriptionExpiringForSecureIntegration();case r.SecureProxy:if(t===o.Host){const e=OneSignal.proxyFrameHost;if(e)return yield e.runCommand(OneSignal.POSTMAM_COMMANDS.SUBSCRIPTION_EXPIRATION_STATE);throw new InvalidStateError(Ge.NoProxyFrame)}return yield this.isSubscriptionExpiringForSecureIntegration();case r.InsecureProxy:{const{expirationTime:e}=yield ie.getSubscription();return!!e&&(new Date).getTime()>=e}}}))}isSubscriptionExpiringForSecureIntegration(){return e(this,void 0,void 0,(function*(){if((yield this.context.serviceWorkerManager.getActiveState())!==We.OneSignalWorker)return!1;const e=yield this.context.serviceWorkerManager.getRegistration();if(!e)return!1;if(!e.pushManager)return!1;const t=yield e.pushManager.getSubscription();if(!t)return!1;if(!t.expirationTime)return!1;let{createdAt:i}=yield ie.getSubscription();if(!i){const e=31536e6;i=(new Date).getTime()+e}const n=i+(t.expirationTime-i)/2;return!!t.expirationTime&&((new Date).getTime()>=t.expirationTime||(new Date).getTime()>=n)}))}getSubscriptionState(){return e(this,void 0,void 0,(function*(){if(I.useSafariLegacyPush())return this.getSubscriptionStateForSecure();const e=S.getWindowEnv();if(e===o.ServiceWorker){const e=yield self.registration.pushManager.getSubscription(),{optedOut:t}=yield ie.getSubscription();return{subscribed:!!e,optedOut:!!t}}switch(yield S.getIntegration()){case r.Secure:return this.getSubscriptionStateForSecure();case r.SecureProxy:switch(e){case o.OneSignalProxyFrame:case o.OneSignalSubscriptionPopup:case o.OneSignalSubscriptionModal:return this.getSubscriptionStateForSecure();default:{const e=OneSignal.proxyFrameHost;return yield e.runCommand(OneSignal.POSTMAM_COMMANDS.GET_SUBSCRIPTION_STATE)}}case r.InsecureProxy:return yield this.getSubscriptionStateForInsecure();default:throw new InvalidStateError(Ge.UnsupportedEnvironment)}}))}getSubscriptionStateForSecure(){return e(this,void 0,void 0,(function*(){var e,t;const{optedOut:i,subscriptionToken:n}=yield ie.getSubscription(),o=yield OneSignal.coreDirector.getPushSubscriptionModel(),s=gt(null==o?void 0:o.data)&&!!(null==o?void 0:o.onesignalId);if(I.useSafariLegacyPush()){const o=null===(t=null===(e=window.safari)||void 0===e?void 0:e.pushNotification)||void 0===t?void 0:t.permission(this.config.safariWebId);return{subscribed:!!(s&&n&&"granted"===(null==o?void 0:o.permission)&&(null==o?void 0:o.deviceToken)),optedOut:!!i}}const r=yield this.context.serviceWorkerManager.getActiveState(),a=yield this.context.serviceWorkerManager.getRegistration(),c=yield this.context.permissionManager.getNotificationPermission(this.context.appConfig.safariWebId),d=r===We.OneSignalWorker;if(!a)return{subscribed:!1,optedOut:!!i};return{subscribed:!!(s&&n&&c===x.Granted&&d),optedOut:!!i}}))}getSubscriptionStateForInsecure(){return e(this,void 0,void 0,(function*(){const{deviceId:e,subscriptionToken:t,optedOut:i}=yield ie.getSubscription(),n=yield this.context.permissionManager.getNotificationPermission(this.context.appConfig.safariWebId);return{subscribed:!(!e||!t||n!==x.Granted),optedOut:!!i}}))}registerFailedSubscription(t,i){return e(this,void 0,void 0,(function*(){i.pageViewManager.isFirstPageView()&&(i.subscriptionManager.registerSubscription(new Ze,t),i.pageViewManager.incrementPageViewCount())}))}}const ft=class{static getServiceWorkerManager(e){const t=e.appConfig,i={workerPath:new U("OneSignalSDKWorker.js"),registrationOptions:{scope:"/"}};return t.userConfig&&(t.userConfig.path&&(i.workerPath=new U(`${t.userConfig.path}${t.userConfig.serviceWorkerPath}`)),t.userConfig.serviceWorkerParam&&(i.registrationOptions=t.userConfig.serviceWorkerParam)),new nt(e,i)}static getSubscriptionManager(e){const t=e.appConfig,i={safariWebId:t.safariWebId,appId:t.appId,vapidPublicKey:t.vapidPublicKey,onesignalVapidPublicKey:t.onesignalVapidPublicKey};return new pt(e,i)}};class ht{static addExternalUserIdToDeviceRecord(t){return e(this,void 0,void 0,(function*(){const e=yield ie.getExternalUserId();if(!e)return;t.externalUserId=e;const i=yield ie.getExternalUserIdAuthHash();i&&(t.externalUserIdAuthHash=i)}))}}class vt{constructor(e){this.context=e,this.onSessionSent=e.pageViewManager.getPageViewCount()>1}isDeviceIdAvailable(){return e(this,void 0,void 0,(function*(){return null!=(yield ie.getSubscription()).deviceId}))}createDeviceRecord(){return e(this,void 0,void 0,(function*(){return tt.createDeviceRecord(this.context.appConfig.appId)}))}sendPushDeviceRecordUpdate(){return e(this,void 0,void 0,(function*(){var e;(null===(e=ut.singletonInstance)||void 0===e?void 0:e.hasOneSignalId)?this.onSessionSent||(yield this.sendOnSessionUpdate()):f.debug("Not sending the update because user is not registered with OneSignal (no onesignal_id)")}))}sendOnSessionUpdate(){return e(this,void 0,void 0,(function*(){var e;if(this.onSessionSent)return;if(!this.context.pageViewManager.isFirstPageView())return;if(!(yield this.context.subscriptionManager.isAlreadyRegisteredWithOneSignal()))return void f.debug("Not sending the on session because user is not registered with OneSignal (no device id)");const t=yield OneSignal.coreDirector.getPushSubscriptionModel();if((null==t?void 0:t.data.notification_types)===we.Subscribed||!0===(null===(e=OneSignal.config)||void 0===e?void 0:e.enableOnSession))try{this.context.sessionManager.upsertSession(K.PlayerOnSession),this.onSessionSent=!0}catch(e){f.error(`Failed to update user session. Error "${e.message}" ${e.stack}`)}}))}sendPlayerCreate(t){return e(this,void 0,void 0,(function*(){yield ht.addExternalUserIdToDeviceRecord(t);try{const e=yield Me.createUser(t);return e?(f.info("Subscribed to web push and registered with OneSignal",t,e),this.onSessionSent=!0,this.context.sessionManager.upsertSession(K.PlayerCreate),e):void f.error("Failed to create user.")}catch(e){return void f.error(`Failed to create user. Error "${e.message}" ${e.stack}`)}}))}onSessionAlreadyCalled(){return this.onSessionSent}sendExternalUserIdUpdate(t,i){return e(this,void 0,void 0,(function*(){i||(i=yield ie.getExternalUserIdAuthHash());const e={external_user_id:p.getValueOrDefault(t,""),external_user_id_auth_hash:p.getValueOrDefault(i,void 0)},n=this.sendPushPlayerUpdate(e);(yield this.isDeviceIdAvailable())&&(yield n)}))}sendTagsUpdate(t){return e(this,void 0,void 0,(function*(){const e={tags:t},i=yield ie.getExternalUserIdAuthHash();i&&(e.external_user_id_auth_hash=i);const n=this.sendPushPlayerUpdate(e);(yield this.isDeviceIdAvailable())&&(yield n)}))}sendPushPlayerUpdate(t){return e(this,void 0,void 0,(function*(){let{deviceId:i}=yield ie.getSubscription();i||(yield function(t){return e(this,void 0,void 0,(function*(){return yield new Promise((e=>{OneSignal.emitter.once(t,(t=>{e(t)}))}))}))}(OneSignal.EVENTS.REGISTERED),({deviceId:i}=yield ie.getSubscription())),i&&(yield Me.updatePlayer(this.context.appConfig.appId,i,t))}))}sendOutcomeDirect(t,i,n,o){return e(this,void 0,void 0,(function*(){he("sendOutcomeDirect");const e=yield OneSignal.coreDirector.getPushSubscriptionModel();if(e&&gt(null==e?void 0:e.data)){const s={id:n,app_id:t,notification_ids:i,direct:!0,subscription:{id:e.data.id,type:Ie.getSubscriptionType()}};return void 0!==o&&(s.weight=o),void(yield Me.sendOutcome(s))}f.warn("Send outcome aborted because pushSubscriptionModel is not available.")}))}sendOutcomeInfluenced(t,i,n,o){return e(this,void 0,void 0,(function*(){he("sendOutcomeInfluenced");const e=yield OneSignal.coreDirector.getPushSubscriptionModel();if(e&&gt(null==e?void 0:e.data)){const s={id:n,app_id:t,notification_ids:i,direct:!1,subscription:{id:e.data.id,type:Ie.getSubscriptionType()}};return void 0!==o&&(s.weight=o),void(yield Me.sendOutcome(s))}f.warn("Send outcome aborted because pushSubscriptionModel is not available.")}))}sendOutcomeUnattributed(t,i,n){return e(this,void 0,void 0,(function*(){he("sendOutcomeUnattributed");const e=yield OneSignal.coreDirector.getPushSubscriptionModel();if(e&&gt(null==e?void 0:e.data)){const o={id:i,app_id:t,subscription:{id:e.data.id,type:Ie.getSubscriptionType()}};return void 0!==n&&(o.weight=n),void(yield Me.sendOutcome(o))}f.warn("Send outcome aborted because pushSubscriptionModel is not available.")}))}}class mt{upsertSession(t){return e(this,void 0,void 0,(function*(){}))}setupSessionEventListeners(){return e(this,void 0,void 0,(function*(){}))}}class bt{constructor(e){this.appConfig=e,this.subscriptionManager=ft.getSubscriptionManager(this),this.serviceWorkerManager=ft.getServiceWorkerManager(this),this.pageViewManager=new D,this.sessionManager=new mt,this.permissionManager=new N,this.workerMessenger=new C(this),this.updateManager=new vt(this)}}const St=30,yt=!1,wt=!0,Ot={pageViews:1,timeDelay:0},It="We'd like to show you notifications for the latest news and updates.",Pt="Allow",kt="Cancel",xt={updateMessage:"Update your push notification subscription preferences.",positiveUpdateButton:"Save Preferences",negativeUpdateButton:"Cancel"},Et="Thank You!",Ct={type:Ke.Push,text:{actionMessage:It,acceptButton:Pt,cancelButton:kt},autoPrompt:!1,delay:Ot};class Nt{static convertTagsApiToBooleans(e){const t={};return Object.keys(e).forEach((i=>{t[i]="1"===e[i]})),t}static convertTagsBooleansToApi(e){const t={};return Object.keys(e).forEach((i=>{t[i]=!0===e[i]?"1":"0"})),t}static getObjectDifference(e,t){const i={};return Object.keys(e).forEach((n=>{t[n]!==e[n]&&(i[n]=e[n])})),i}static markAllTagsAsSpecified(e,t){e.forEach((e=>{e.checked=t}))}static isTagObjectEmpty(e){return 0===Object.keys(e).length}static getCheckedTagCategories(e,t){if(!t)return e;if(Nt.isTagObjectEmpty(t)){const t=me(e);return Nt.markAllTagsAsSpecified(t,!0),t}return me(e).map((e=>{const i=t[e.tag];return e.checked=Nt.getCheckedStatusForTagValue(i),e}))}static getCheckedStatusForTagValue(e){return void 0===e||e}static limitCategoriesToMaxCount(e,t){let i=me(e);return i=e.slice(0,t),i}}class At{static upgradeConfigToVersionTwo(e){var t,i,n;At.isPromptOptionsVersion0(e.promptOptions)&&(e.promptOptions=At.convertConfigToVersionOne(e.promptOptions)),At.isSlidedownConfigVersion1(null===(t=e.promptOptions)||void 0===t?void 0:t.slidedown)&&(null===(i=e.promptOptions)||void 0===i?void 0:i.slidedown)&&(e.promptOptions.slidedown=At.convertConfigToVersionTwo(null===(n=e.promptOptions)||void 0===n?void 0:n.slidedown))}static convertConfigToVersionOne(e){e.slidedown||(e.slidedown={});const{acceptButtonText:t,cancelButtonText:i,actionMessage:n}=e.slidedown,o=e.acceptButtonText||e.acceptButton,s=e.cancelButtonText||e.cancelButton;return e.slidedown.acceptButtonText=t||o,e.slidedown.cancelButtonText=i||s,e.slidedown.actionMessage=n||e.actionMessage,e}static convertConfigToVersionTwo(e){var t,i,n,o;const s=Qe.isCategorySlidedownConfiguredVersion1(e)?Ke.Category:Ke.Push;let r,a;s===Ke.Category&&(r=null===(t=e.categories)||void 0===t?void 0:t.positiveUpdateButton,a=null===(i=e.categories)||void 0===i?void 0:i.negativeUpdateButton);return{prompts:[...e.prompts||[],{type:s,autoPrompt:e.autoPrompt,text:{actionMessage:e.actionMessage,acceptButton:e.acceptButton||e.acceptButtonText,cancelButton:e.cancelButton||e.cancelButtonText,positiveUpdateButton:r,negativeUpdateButton:a,updateMessage:null===(n=null==e?void 0:e.categories)||void 0===n?void 0:n.updateMessage},delay:{pageViews:e.pageViews,timeDelay:e.timeDelay},categories:null===(o=null==e?void 0:e.categories)||void 0===o?void 0:o.tags}]}}static isPromptOptionsVersion0(e){if(e){const t=["acceptButtonText","cancelButtonText","actionMessage"];for(let i=0;i<t.length;i++)if(e.hasOwnProperty(t[i]))return!0}return!1}static isSlidedownConfigVersion1(e){if(e){const t=["enabled","autoPrompt","pageViews","timeDelay","acceptButton","acceptButtonText","cancelButton","cancelButtonText","actionMessage","customizeTextEnabled","categories"];for(let i=0;i<t.length;i++)if(e.hasOwnProperty(t[i]))return!0}return!1}}var Tt,Mt,Dt,Ut;!function(e){e.TypicalSite="typical",e.WordPress="wordpress",e.Shopify="shopify",e.Blogger="blogger",e.Magento="magento",e.Drupal="drupal",e.SquareSpace="squarespace",e.Joomla="joomla",e.Weebly="weebly",e.Wix="wix",e.Custom="custom"}(Tt||(Tt={})),function(e){e.Exact="exact",e.Origin="origin"}(Mt||(Mt={})),function(e){e.Navigate="navigate",e.Focus="focus"}(Dt||(Dt={})),function(e){e[e.Dashboard=0]="Dashboard",e[e.JavaScript=1]="JavaScript"}(Ut||(Ut={}));class Wt{static getAppConfig(t,i){return e(this,void 0,void 0,(function*(){try{if(!t||!t.appId||!m.isValidUuid(t.appId))throw new SdkInitError(Ae.InvalidAppId);const e=yield i(t.appId);At.upgradeConfigToVersionTwo(t);const n=this.getMergedConfig(t,e);return this.checkRestrictedOrigin(n),n}catch(e){if(e){if(1===e.code)throw new SdkInitError(Ae.InvalidAppId);if(2===e.code)throw new SdkInitError(Ae.AppNotConfiguredForWebPush)}throw e}}))}static checkRestrictedOrigin(e){if(e.restrictedOriginEnabled&&S.getWindowEnv()!==o.ServiceWorker&&window.top===window&&!p.contains(window.location.hostname,".os.tc")&&!p.contains(window.location.hostname,".onesignal.com")&&!this.doesCurrentOriginMatchConfigOrigin(e.origin))throw new SdkInitError(Ae.WrongSiteUrl,{siteUrl:e.origin})}static doesCurrentOriginMatchConfigOrigin(e){try{return location.origin===new URL(e).origin}catch(e){return!1}}static getIntegrationCapabilities(e){switch(e){case Tt.Custom:case Tt.WordPress:return{configuration:Ut.JavaScript};default:return{configuration:Ut.Dashboard}}}static getMergedConfig(e,t){const i=this.getConfigIntegrationKind(t),n=this.getSubdomainForConfigIntegrationKind(i,e,t),o=t.config.setupBehavior?t.config.setupBehavior.allowLocalhostAsSecureOrigin:e.allowLocalhostAsSecureOrigin,s=m.internalIsUsingSubscriptionWorkaround(n,o),r=this.getUserConfigForConfigIntegrationKind(i,e,t,s);return{appId:t.app_id,subdomain:n,siteName:t.config.siteInfo.name,origin:t.config.origin,httpUseOneSignalCom:t.config.http_use_onesignal_com,restrictedOriginEnabled:t.features.restrict_origin&&t.features.restrict_origin.enable,metrics:{enable:t.features.metrics.enable,mixpanelReportingToken:t.features.metrics.mixpanel_reporting_token},safariWebId:t.config.safari_web_id,vapidPublicKey:t.config.vapid_public_key,onesignalVapidPublicKey:t.config.onesignal_vapid_public_key,userConfig:r,enableOnSession:p.valueOrDefault(t.features.enable_on_session,yt),sessionThreshold:p.valueOrDefault(t.features.session_threshold,St),enableSessionDuration:p.valueOrDefault(t.features.web_on_focus_enabled,wt)}}static getConfigIntegrationKind(e){return e.config.integration?e.config.integration.kind:Tt.Custom}static getCustomLinkConfig(e){const t={enabled:!1,style:"button",size:"medium",unsubscribeEnabled:!1,text:{explanation:"",subscribe:"",unsubscribe:""},color:{button:"",text:""}};if(!(e&&e.config&&e.config.staticPrompts&&e.config.staticPrompts.customlink&&e.config.staticPrompts.customlink.enabled))return t;const i=e.config.staticPrompts.customlink;return{enabled:i.enabled,style:i.style,size:i.size,unsubscribeEnabled:i.unsubscribeEnabled,text:i.text?{subscribe:i.text.subscribe,unsubscribe:i.text.unsubscribe,explanation:i.text.explanation}:t.text,color:i.color?{button:i.color.button,text:i.color.text}:t.color}}static injectDefaultsIntoPromptOptions(e,t,i,n=!1){var o,s;let r={enabled:!1};e&&e.customlink&&(r=e.customlink);const a=t.customlink,c=Object.assign(Object.assign({},e),{customlink:{enabled:p.getValueOrDefault(r.enabled,a.enabled),style:p.getValueOrDefault(r.style,a.style),size:p.getValueOrDefault(r.size,a.size),unsubscribeEnabled:p.getValueOrDefault(r.unsubscribeEnabled,a.unsubscribeEnabled),text:{subscribe:p.getValueOrDefault(r.text?r.text.subscribe:void 0,a.text.subscribe),unsubscribe:p.getValueOrDefault(r.text?r.text.unsubscribe:void 0,a.text.unsubscribe),explanation:p.getValueOrDefault(r.text?r.text.explanation:void 0,a.text.explanation)},color:{button:p.getValueOrDefault(r.color?r.color.button:void 0,a.color.button),text:p.getValueOrDefault(r.color?r.color.text:void 0,a.color.text)}}});if(c.slidedown?c.slidedown.prompts=null===(s=null===(o=c.slidedown)||void 0===o?void 0:o.prompts)||void 0===s?void 0:s.map((e=>{var t,i,n,o,s,r,a,c,d;if(e.type=p.getValueOrDefault(e.type,Ke.Push),e.type===Ke.Category&&(e.text=Object.assign(Object.assign({},e.text),{positiveUpdateButton:p.getValueOrDefault(null===(t=e.text)||void 0===t?void 0:t.positiveUpdateButton,xt.positiveUpdateButton),negativeUpdateButton:p.getValueOrDefault(null===(i=e.text)||void 0===i?void 0:i.negativeUpdateButton,xt.negativeUpdateButton),updateMessage:p.getValueOrDefault(null===(n=e.text)||void 0===n?void 0:n.updateMessage,xt.updateMessage)})),e.text=Object.assign(Object.assign({},e.text),{actionMessage:p.getValueOrDefault(null===(o=e.text)||void 0===o?void 0:o.actionMessage,It),acceptButton:p.getValueOrDefault(null===(s=e.text)||void 0===s?void 0:s.acceptButton,Pt),cancelButton:p.getValueOrDefault(null===(r=e.text)||void 0===r?void 0:r.cancelButton,kt),confirmMessage:p.getValueOrDefault(null===(a=e.text)||void 0===a?void 0:a.confirmMessage,Et)}),e.autoPrompt=p.getValueOrDefault(e.autoPrompt,!0),e.delay={pageViews:p.getValueOrDefault(null===(c=e.delay)||void 0===c?void 0:c.pageViews,Ot.pageViews),timeDelay:p.getValueOrDefault(null===(d=e.delay)||void 0===d?void 0:d.timeDelay,Ot.timeDelay)},e.categories){const{categories:t}=e;e.categories=Nt.limitCategoriesToMaxCount(t,10)}return e})):(c.slidedown={prompts:[]},c.slidedown.prompts=[Ct]),c.native?(c.native.enabled=!!c.native.enabled,c.native.autoPrompt=c.native.hasOwnProperty("autoPrompt")?!!c.native.enabled&&!!c.native.autoPrompt:!!c.native.enabled,c.native.pageViews=p.getValueOrDefault(c.native.pageViews,Ot.pageViews),c.native.timeDelay=p.getValueOrDefault(c.native.timeDelay,Ot.timeDelay)):c.native={enabled:!1,autoPrompt:!1,pageViews:Ot.pageViews,timeDelay:Ot.timeDelay},!0===i.autoRegister)if(n){c.native.enabled=!1,c.native.autoPrompt=!1;const e={actionMessage:It,acceptButton:Pt,cancelButton:kt};c.slidedown.prompts=[{type:Ke.Push,autoPrompt:!0,text:e}]}else c.native.enabled=!0,c.native.autoPrompt=!0;return c.autoPrompt=c.native.autoPrompt||Qe.isSlidedownAutoPromptConfigured(c.slidedown.prompts),c}static getPromptOptionsForDashboardConfiguration(e){const t=e.config.staticPrompts,i=t.native?{enabled:t.native.enabled,autoPrompt:t.native.enabled&&!1!==t.native.autoPrompt,pageViews:p.getValueOrDefault(t.native.pageViews,Ot.pageViews),timeDelay:p.getValueOrDefault(t.native.timeDelay,Ot.timeDelay)}:{enabled:!1,autoPrompt:!1,pageViews:Ot.pageViews,timeDelay:Ot.timeDelay},{prompts:n}=t.slidedown;return{autoPrompt:i.autoPrompt||Qe.isSlidedownAutoPromptConfigured(n),native:i,slidedown:{prompts:n},fullscreen:{enabled:t.fullscreen.enabled,actionMessage:t.fullscreen.actionMessage,acceptButton:t.fullscreen.acceptButton,cancelButton:t.fullscreen.cancelButton,title:t.fullscreen.title,message:t.fullscreen.message,caption:t.fullscreen.caption,autoAcceptTitle:t.fullscreen.autoAcceptTitle},customlink:this.getCustomLinkConfig(e)}}static getUserConfigForConfigIntegrationKind(e,t,i,n=!1){switch(this.getIntegrationCapabilities(e).configuration){case Ut.Dashboard:return{appId:i.app_id,autoRegister:!1,autoResubscribe:i.config.autoResubscribe,path:i.config.serviceWorker.path,serviceWorkerPath:i.config.serviceWorker.workerName,serviceWorkerParam:{scope:i.config.serviceWorker.registrationScope},subdomainName:i.config.siteInfo.proxyOrigin,promptOptions:this.getPromptOptionsForDashboardConfiguration(i),welcomeNotification:{disable:!i.config.welcomeNotification.enable,title:i.config.welcomeNotification.title,message:i.config.welcomeNotification.message,url:i.config.welcomeNotification.url},notifyButton:{enable:i.config.staticPrompts.bell.enabled,displayPredicate:i.config.staticPrompts.bell.hideWhenSubscribed?()=>!OneSignal.User.PushSubscription.optedIn:null,size:i.config.staticPrompts.bell.size,position:i.config.staticPrompts.bell.location,showCredit:!1,offset:{bottom:`${i.config.staticPrompts.bell.offset.bottom}px`,left:`${i.config.staticPrompts.bell.offset.left}px`,right:`${i.config.staticPrompts.bell.offset.right}px`},colors:{"circle.background":i.config.staticPrompts.bell.color.main,"circle.foreground":i.config.staticPrompts.bell.color.accent,"badge.background":"black","badge.foreground":"white","badge.bordercolor":"black","pulse.color":i.config.staticPrompts.bell.color.accent,"dialog.button.background.hovering":i.config.staticPrompts.bell.color.main,"dialog.button.background.active":i.config.staticPrompts.bell.color.main,"dialog.button.background":i.config.staticPrompts.bell.color.main,"dialog.button.foreground":"white"},text:{"tip.state.unsubscribed":i.config.staticPrompts.bell.tooltip.unsubscribed,"tip.state.subscribed":i.config.staticPrompts.bell.tooltip.subscribed,"tip.state.blocked":i.config.staticPrompts.bell.tooltip.blocked,"message.prenotify":i.config.staticPrompts.bell.tooltip.unsubscribed,"message.action.subscribing":i.config.staticPrompts.bell.message.subscribing,"message.action.subscribed":i.config.staticPrompts.bell.message.subscribing,"message.action.resubscribed":i.config.staticPrompts.bell.message.subscribing,"message.action.unsubscribed":i.config.staticPrompts.bell.message.unsubscribing,"dialog.main.title":i.config.staticPrompts.bell.dialog.main.title,"dialog.main.button.subscribe":i.config.staticPrompts.bell.dialog.main.subscribeButton,"dialog.main.button.unsubscribe":i.config.staticPrompts.bell.dialog.main.unsubscribeButton,"dialog.blocked.title":i.config.staticPrompts.bell.dialog.blocked.title,"dialog.blocked.message":i.config.staticPrompts.bell.dialog.blocked.message}},persistNotification:i.config.notificationBehavior?i.config.notificationBehavior.display.persist:void 0,webhooks:{cors:i.config.webhooks.corsEnable,"notification.willDisplay":i.config.webhooks.notificationWillDisplayHook,"notification.clicked":i.config.webhooks.notificationClickedHook,"notification.dismissed":i.config.webhooks.notificationDismissedHook},notificationClickHandlerMatch:i.config.notificationBehavior?i.config.notificationBehavior.click.match:void 0,notificationClickHandlerAction:i.config.notificationBehavior?i.config.notificationBehavior.click.action:void 0,allowLocalhostAsSecureOrigin:i.config.setupBehavior?i.config.setupBehavior.allowLocalhostAsSecureOrigin:void 0,outcomes:{direct:i.config.outcomes.direct,indirect:{enabled:i.config.outcomes.indirect.enabled,influencedTimePeriodMin:i.config.outcomes.indirect.notification_attribution.minutes_since_displayed,influencedNotificationsLimit:i.config.outcomes.indirect.notification_attribution.limit},unattributed:i.config.outcomes.unattributed}};case Ut.JavaScript:{const e={scope:"/"},o="OneSignalSDKWorker.js",s=Object.assign(Object.assign(Object.assign(Object.assign({},t),{promptOptions:this.injectDefaultsIntoPromptOptions(t.promptOptions,i.config.staticPrompts,t,n)}),{serviceWorkerParam:t.serviceWorkerParam?t.serviceWorkerParam:e,serviceWorkerPath:t.serviceWorkerPath?t.serviceWorkerPath:o,path:t.path?t.path:"/"}),{outcomes:{direct:i.config.outcomes.direct,indirect:{enabled:i.config.outcomes.indirect.enabled,influencedTimePeriodMin:i.config.outcomes.indirect.notification_attribution.minutes_since_displayed,influencedNotificationsLimit:i.config.outcomes.indirect.notification_attribution.limit},unattributed:i.config.outcomes.unattributed}});return t.hasOwnProperty("autoResubscribe")?s.autoResubscribe=!!t.autoResubscribe:t.hasOwnProperty("autoRegister")?s.autoResubscribe=!!t.autoRegister:s.autoResubscribe=!!i.config.autoResubscribe,s}}}static getSubdomainForConfigIntegrationKind(e,t,i){const n=this.getIntegrationCapabilities(e),o=t.subdomainName;let s="";switch(n.configuration){case Ut.Dashboard:s=i.config.siteInfo.proxyOriginEnabled?i.config.siteInfo.proxyOrigin:void 0;break;case Ut.JavaScript:s=i.config.subdomain}return s&&!this.shouldUseServerConfigSubdomain(o,n)?void 0:s}static shouldUseServerConfigSubdomain(e,t){switch(t.configuration){case Ut.Dashboard:return!0;case Ut.JavaScript:switch(location.protocol){case"https:":return!!e;case"http:":return!0;default:return!1}}}}class _t{static toOSNotification(e){return{notificationId:e.custom.i,title:e.title,body:e.alert,additionalData:e.custom.a,launchURL:e.custom.u,confirmDelivery:"y"===e.custom.rr,icon:e.icon,image:e.image,actionButtons:this.convertButtons(e.o),topic:e.tag,badgeIcon:e.badge}}static convertButtons(e){return null==e?void 0:e.map((e=>({actionId:e.i,text:e.n,icon:e.p,launchURL:e.u})))}static isValid(e){var t;return"string"==typeof(null===(t=null==e?void 0:e.custom)||void 0===t?void 0:t.i)}}class Rt{send(t){return e(this,void 0,void 0,(function*(){const e=yield ie.get("Options",`webhooks.${t.event}`);if(!e)return;const i=yield ie.get("Options","webhooks.cors"),n={method:"post",mode:"no-cors",body:JSON.stringify(t)};i&&(n.mode="cors",n.headers={"X-OneSignal-Event":t.event,"Content-Type":"application/json"}),de.debug(`Executing ${t.event} webhook ${i?"with":"without"} CORS POST ${e}`,t),yield fetch(e,n)}))}}class Ft{constructor(e){this.event="notification.clicked";const t=e.notification;this.notificationId=t.notificationId,this.heading=t.title,this.content=t.body,this.additionalData=t.additionalData,this.actionId=e.result.actionId}}class Vt{constructor(e){this.event="notification.willDisplay",this.notificationId=e.notificationId,this.heading=e.title,this.content=e.body,this.additionalData=e.additionalData}}class Lt{constructor(e){this.event="notification.dismiss",this.notificationId=e.notificationId,this.heading=e.title,this.content=e.body,this.additionalData=e.additionalData}}class Bt{constructor(e=new Rt){this.sender=e}click(t){return e(this,void 0,void 0,(function*(){return yield this.sender.send(new Ft(t))}))}willDisplay(t){return e(this,void 0,void 0,(function*(){return yield this.sender.send(new Vt(t))}))}dismiss(t){return e(this,void 0,void 0,(function*(){return yield this.sender.send(new Lt(t))}))}}class $t{static toNative(e){return null==e?void 0:e.map((e=>({action:e.actionId,title:e.text,icon:e.icon})))}}class Ht{static getPushSubscriptionIdByToken(t){return e(this,void 0,void 0,(function*(){const e=yield ie.getAll(_.PushSubscriptions);for(const i of e)if(i.token===t)return i.id}))}}class jt{static get VERSION(){return I.version()}static get environment(){return I}static get log(){return de}static get database(){return ie}static get webhookNotificationEventSender(){return new Bt}static getPushSubscriptionId(){return e(this,void 0,void 0,(function*(){const e=yield self.registration.pushManager.getSubscription(),t=null==e?void 0:e.endpoint;if(t)return Ht.getPushSubscriptionIdByToken(t)}))}static get workerMessenger(){return self.workerMessenger||(self.workerMessenger=new C),self.workerMessenger}static run(){self.addEventListener("activate",jt.onServiceWorkerActivated),self.addEventListener("push",jt.onPushReceived),self.addEventListener("notificationclose",jt.onNotificationClosed),self.addEventListener("notificationclick",(e=>e.waitUntil(jt.onNotificationClicked(e)))),self.addEventListener("pushsubscriptionchange",(e=>{e.waitUntil(jt.onPushSubscriptionChange(e))})),self.addEventListener("message",(e=>{const t=e.data;if(!t||!t.command)return;const i=t.payload;switch(t.command){case k.SessionUpsert:de.debug("[Service Worker] Received SessionUpsert",i),jt.debounceRefreshSession(e,i);break;case k.SessionDeactivate:de.debug("[Service Worker] Received SessionDeactivate",i),jt.debounceRefreshSession(e,i);break;default:return}})),de.debug("Setting up message listeners."),jt.workerMessenger.listen(),jt.setupMessageListeners()}static getAppId(){return e(this,void 0,void 0,(function*(){if(self.location.search){const e=self.location.search.match(/appId=([0-9a-z-]+)&?/i);if(e&&e.length>1){return e[1]}}const{appId:e}=yield ie.getAppConfig();return e}))}static setupMessageListeners(){jt.workerMessenger.on(k.WorkerVersion,(e=>{de.debug("[Service Worker] Received worker version message."),jt.workerMessenger.broadcast(k.WorkerVersion,I.version())})),jt.workerMessenger.on(k.Subscribe,(t=>e(this,void 0,void 0,(function*(){const e=t;de.debug("[Service Worker] Received subscribe message.");const i=new bt(e),n=yield i.subscriptionManager.subscribe(0),o=yield i.subscriptionManager.registerSubscription(n);jt.workerMessenger.broadcast(k.Subscribe,o.serialize())})))),jt.workerMessenger.on(k.SubscribeNew,(t=>e(this,void 0,void 0,(function*(){const e=t;de.debug("[Service Worker] Received subscribe new message.");const i=new bt(e),n=yield i.subscriptionManager.subscribe(1),o=yield i.subscriptionManager.registerSubscription(n);jt.workerMessenger.broadcast(k.SubscribeNew,o.serialize())})))),jt.workerMessenger.on(k.AmpSubscriptionState,(t=>e(this,void 0,void 0,(function*(){de.debug("[Service Worker] Received AMP subscription state message.");const e=yield self.registration.pushManager.getSubscription();if(e){const t=yield self.registration.pushManager.permissionState(e.options),{optedOut:i}=yield ie.getSubscription(),n=!!e&&"granted"===t&&!0!==i;yield jt.workerMessenger.broadcast(k.AmpSubscriptionState,n)}else yield jt.workerMessenger.broadcast(k.AmpSubscriptionState,!1)})))),jt.workerMessenger.on(k.AmpSubscribe,(()=>e(this,void 0,void 0,(function*(){de.debug("[Service Worker] Received AMP subscribe message.");const e=yield jt.getAppId(),t=yield Wt.getAppConfig({appId:e},De.downloadServerAppConfig),i=new bt(t),n=yield i.subscriptionManager.subscribe(0),o=yield i.subscriptionManager.registerSubscription(n);yield ie.put("Ids",{type:"appId",id:e}),jt.workerMessenger.broadcast(k.AmpSubscribe,o.deviceId)})))),jt.workerMessenger.on(k.AmpUnsubscribe,(()=>e(this,void 0,void 0,(function*(){de.debug("[Service Worker] Received AMP unsubscribe message.");const e=yield jt.getAppId(),t=yield Wt.getAppConfig({appId:e},De.downloadServerAppConfig),i=new bt(t);yield i.subscriptionManager.unsubscribe(1),jt.workerMessenger.broadcast(k.AmpUnsubscribe,null)})))),jt.workerMessenger.on(k.AreYouVisibleResponse,(t=>e(this,void 0,void 0,(function*(){if(de.debug("[Service Worker] Received response for AreYouVisible",t),!self.clientsStatus)return;const e=t.timestamp;self.clientsStatus.timestamp===e&&(self.clientsStatus.receivedResponsesCount++,t.focused&&(self.clientsStatus.hasAnyActiveSessions=!0))})))),jt.workerMessenger.on(k.SetLogging,(t=>e(this,void 0,void 0,(function*(){t.shouldLog?self.shouldLog=!0:self.shouldLog=void 0}))))}static onPushReceived(t){de.debug(`Called onPushReceived(${JSON.stringify(t,null,4)}):`,t),t.waitUntil(jt.parseOrFetchNotifications(t).then((t=>e(this,void 0,void 0,(function*(){const i=[],n=[],o=yield jt.getAppId();for(const s of t){de.debug("Raw Notification from OneSignal:",s);const t=_t.toOSNotification(s);n.push(ie.putNotificationReceivedForOutcomes(o,t)),i.push((t=>e(this,void 0,void 0,(function*(){const e={notification:t};return yield jt.workerMessenger.broadcast(k.NotificationWillDisplay,e).catch((e=>de.error(e))),jt.webhookNotificationEventSender.willDisplay(t),jt.displayNotification(t).then((()=>jt.sendConfirmedDelivery(t))).catch((e=>de.error(e)))}))).bind(null,t))}return i.reduce(((e,t)=>e.then(t)),Promise.resolve())})))).catch((e=>{de.debug("Failed to display a notification:",e),jt.UNSUBSCRIBED_FROM_NOTIFICATIONS&&de.debug("Because we have just unsubscribed from notifications, we will not show anything.")})))}static sendConfirmedDelivery(t){return e(this,void 0,void 0,(function*(){if(!t)return;if(!jt.browserSupportsConfirmedDelivery())return null;if(!t.confirmDelivery)return;const e=yield jt.getAppId(),i=yield this.getPushSubscriptionId();if(!!(!e||!t.notificationId))return;const n={player_id:i,app_id:e,device_type:z.prototype.getDeliveryPlatform()};de.debug(`Called sendConfirmedDelivery(${JSON.stringify(t,null,4)})`),yield ke(Math.floor(25*Math.random()*1e3)),yield Ce.put(`notifications/${t.notificationId}/report_received`,n)}))}static browserSupportsConfirmedDelivery(){return"safari"!==h().name}static getActiveClients(){return e(this,void 0,void 0,(function*(){const e=yield self.clients.matchAll({type:"window",includeUncontrolled:!0}),t=[];for(const i of e){const e=i;if(e.isSubdomainIframe=!1,i.frameType&&"nested"===i.frameType){if(!g.contains(i.url,".os.tc")&&!g.contains(i.url,".onesignal.com"))continue;e.isSubdomainIframe=!0}t.push(e)}return t}))}static updateSessionBasedOnHasActive(t,i,n){return e(this,void 0,void 0,(function*(){if(i)yield Ue.upsertSession(n.appId,n.onesignalId,n.subscriptionId,n.sessionThreshold,n.enableSessionDuration,n.sessionOrigin,n.outcomesConfig);else{const e=yield Ue.deactivateSession(n.appId,n.onesignalId,n.subscriptionId,n.sessionThreshold,n.enableSessionDuration,n.outcomesConfig);e&&(self.cancel=e.cancel,t.waitUntil(e.promise))}}))}static refreshSession(t,i){return e(this,void 0,void 0,(function*(){if(de.debug("[Service Worker] refreshSession"),i.isHttps){const e=yield self.clients.matchAll({type:"window",includeUncontrolled:!0});if(i.isSafari)yield jt.checkIfAnyClientsFocusedAndUpdateSession(t,e,i);else{const n=e.some((e=>e.focused));de.debug("[Service Worker] isHttps hasAnyActiveSessions",n),yield jt.updateSessionBasedOnHasActive(t,n,i)}}else{const e=yield jt.getActiveClients();yield jt.checkIfAnyClientsFocusedAndUpdateSession(t,e,i)}}))}static checkIfAnyClientsFocusedAndUpdateSession(t,i,n){return e(this,void 0,void 0,(function*(){const o=(new Date).getTime();self.clientsStatus={timestamp:o,sentRequestsCount:0,receivedResponsesCount:0,hasAnyActiveSessions:!1};const s={timestamp:o};i.forEach((e=>{self.clientsStatus&&self.clientsStatus.sentRequestsCount++,e.postMessage({command:k.AreYouVisible,payload:s})}));const r=le((()=>e(this,void 0,void 0,(function*(){self.clientsStatus&&self.clientsStatus.timestamp===o&&(de.debug("updateSessionBasedOnHasActive",self.clientsStatus),yield jt.updateSessionBasedOnHasActive(t,self.clientsStatus.hasAnyActiveSessions,n),self.clientsStatus=void 0)}))),.5);self.cancel=r.cancel,t.waitUntil(r.promise)}))}static debounceRefreshSession(t,i){de.debug("[Service Worker] debounceRefreshSession",i),self.cancel&&(self.cancel(),self.cancel=void 0);const n=le((()=>e(this,void 0,void 0,(function*(){yield jt.refreshSession(t,i)}))),1);self.cancel=n.cancel,t.waitUntil(n.promise)}static ensureImageResourceHttps(e){if(!e)return null;try{const t=new URL(e);if("localhost"===t.hostname||-1!==t.hostname.indexOf("192.168")||"127.0.0.1"===t.hostname||"https:"===t.protocol)return e;if("i0.wp.com"===t.hostname||"i1.wp.com"===t.hostname||"i2.wp.com"===t.hostname||"i3.wp.com"===t.hostname)return`https://${t.hostname}${t.pathname}`;return`https://i0.wp.com/${t.host+t.pathname}`}catch(e){de.error("ensureImageResourceHttps: ",e)}}static ensureNotificationResourcesHttps(e){if(e&&(e.icon&&(e.icon=jt.ensureImageResourceHttps(e.icon)),e.image&&(e.image=jt.ensureImageResourceHttps(e.image)),e.actionButtons&&e.actionButtons.length>0))for(const t of e.actionButtons)t.icon&&(t.icon=jt.ensureImageResourceHttps(t.icon))}static displayNotification(t){return e(this,void 0,void 0,(function*(){de.debug(`Called displayNotification(${JSON.stringify(t,null,4)}):`,t);const e=yield jt._getTitle(),i=yield ie.get("Options","defaultIcon"),n=yield ie.get("Options","persistNotification"),o=yield jt.getAppId();t.title=t.title?t.title:e,t.icon=t.icon?t.icon:i||void 0,jt.ensureNotificationResourcesHttps(t);const s={body:t.body,icon:t.icon,image:t.image,data:t,actions:$t.toNative(t.actionButtons),tag:t.topic||o,requireInteraction:!1!==n,renotify:!0,badge:t.badgeIcon};return self.registration.showNotification(t.title,s)}))}static shouldOpenNotificationUrl(e){return"javascript:void(0);"!==e&&"do_not_open"!==e&&!g.contains(e,"_osp=do_not_open")}static onNotificationClosed(e){de.debug(`Called onNotificationClosed(${JSON.stringify(e,null,4)}):`,e);const t=e.notification.data;jt.workerMessenger.broadcast(k.NotificationDismissed,t).catch((e=>de.error(e))),e.waitUntil(jt.webhookNotificationEventSender.dismiss(t))}static getNotificationUrlToOpen(t,i){return e(this,void 0,void 0,(function*(){var e;if(i){const n=null===(e=null==t?void 0:t.actionButtons)||void 0===e?void 0:e.find((e=>e.actionId===i));if((null==n?void 0:n.launchURL)&&""!==n.launchURL)return n.launchURL}if(t.launchURL&&""!==t.launchURL)return t.launchURL;const{defaultNotificationUrl:n}=yield ie.getAppState();return n||location.origin}))}static onNotificationClicked(t){return e(this,void 0,void 0,(function*(){de.debug(`Called onNotificationClicked(${JSON.stringify(t,null,4)}):`,t),t.notification.close();const i=t.notification.data;let n="exact",o="navigate";const s=yield ie.get("Options","notificationClickHandlerMatch");s&&(n=s);const r=yield this.database.get("Options","notificationClickHandlerAction");r&&(o=r);const a=yield jt.getNotificationUrlToOpen(i,t.action),c=jt.shouldOpenNotificationUrl(a),d=yield jt.getAppId(),u=z.prototype.getDeliveryPlatform(),l={notification:i,result:{actionId:t.action,url:a},timestamp:(new Date).getTime()};de.info("NotificationClicked",l);const g=(t=>e(this,void 0,void 0,(function*(){try{const e=yield ie.getCurrentSession();if(e&&e.status===j.Active)return;yield ie.putNotificationClickedForOutcomes(d,t),e&&(e.notificationId=t.notification.notificationId,yield ie.upsertSession(e))}catch(e){de.error("Failed to save clicked notification.",e)}})))(l),p=yield this.getPushSubscriptionId(),f=jt.sendConvertedAPIRequests(d,p,l,u),h=yield jt.getActiveClients();let v=!1;for(const e of h){let t=e.url;if(e.isSubdomainIframe){const e=yield ie.get("Options","lastKnownHostUrl");t=e,e||(t=yield ie.get("Options","defaultUrl"))}let i="";try{i=new URL(t).origin}catch(e){de.error("Failed to get the HTTP site's actual origin:",e)}let s=null;try{s=new URL(a).origin}catch(e){de.error("Failed parse launchUrl:",e)}if("exact"===n&&t===a||"origin"===n&&i===s){if(e.isSubdomainIframe&&t===a||!e.isSubdomainIframe&&e.url===a||"focus"===o&&i===s){jt.workerMessenger.unicast(k.NotificationClicked,l,e);try{e instanceof WindowClient&&(yield e.focus())}catch(t){de.error("Failed to focus:",e,t)}}else if(e.isSubdomainIframe){try{de.debug("Client is subdomain iFrame. Attempting to focus() client."),e instanceof WindowClient&&(yield e.focus())}catch(t){de.error("Failed to focus:",e,t)}c?(de.debug(`Redirecting HTTP site to ${a}.`),yield ie.putNotificationClickedEventPendingUrlOpening(l),jt.workerMessenger.unicast(k.RedirectPage,a,e)):de.debug("Not navigating because link is special.")}else if(e instanceof WindowClient&&e.navigate){try{de.debug("Client is standard HTTPS site. Attempting to focus() client."),e instanceof WindowClient&&(yield e.focus())}catch(t){de.error("Failed to focus:",e,t)}try{c?(de.debug(`Redirecting HTTPS site to (${a}).`),yield ie.putNotificationClickedEventPendingUrlOpening(l),yield e.navigate(a)):de.debug("Not navigating because link is special.")}catch(t){de.error("Failed to navigate:",e,a,t)}}else yield ie.putNotificationClickedEventPendingUrlOpening(l),yield jt.openUrl(a);v=!0;break}}return c&&!v&&(yield ie.putNotificationClickedEventPendingUrlOpening(l),yield jt.openUrl(a)),g&&(yield g),yield f}))}static sendConvertedAPIRequests(t,i,n,o){return e(this,void 0,void 0,(function*(){const e=n.notification;if(!e.notificationId)return void console.error("No notification id, skipping networks calls to report open!");let s;t?s=Ce.put(`notifications/${e.notificationId}`,{app_id:t,player_id:i,opened:!0,device_type:o}):console.error("No app Id, skipping OneSignal API call for notification open!"),yield jt.webhookNotificationEventSender.click(n),s&&(yield s)}))}static openUrl(t){return e(this,void 0,void 0,(function*(){de.debug("Opening notification URL:",t);try{return yield self.clients.openWindow(t)}catch(e){return de.warn(`Failed to open the URL '${t}':`,e),null}}))}static onServiceWorkerActivated(e){de.info(`OneSignal Service Worker activated (version ${I.version()})`),e.waitUntil(self.clients.claim())}static onPushSubscriptionChange(t){return e(this,void 0,void 0,(function*(){de.debug(`Called onPushSubscriptionChange(${JSON.stringify(t,null,4)}):`,t);const e=yield jt.getAppId();if(!e)return;const i=yield Wt.getAppConfig({appId:e},De.downloadServerAppConfig);if(!i)return;const n=new bt(i);let o,s;{let{deviceId:i}=yield ie.getSubscription();if(o=!!i,!o&&t.oldSubscription){i=yield De.getUserIdFromSubscriptionIdentifier(e,Xe.prototype.getDeliveryPlatform(),t.oldSubscription.endpoint);const n=yield ie.getSubscription();n.deviceId=i,yield ie.setSubscription(n)}o=!!i}const r=t.newSubscription;if(r)s=Ze.setFromW3cSubscription(r);else try{s=yield n.subscriptionManager.subscribe(1)}catch(e){}if(o||!!s){let e=null;"granted"!==Notification.permission?e=we.PermissionRevoked:s||(e=we.PushSubscriptionRevoked),yield n.subscriptionManager.registerSubscription(s,e)}else yield ie.remove("Ids","userId"),yield ie.remove("Ids","registrationId")}))}static _getTitle(){return new Promise((e=>{Promise.all([ie.get("Options","defaultTitle"),ie.get("Options","pageTitle")]).then((([t,i])=>{e(null!==t?t:null!=i?i:"")}))}))}static parseOrFetchNotifications(e){if(!e||!e.data)return Promise.reject("Missing event.data on push payload!");if(jt.isValidPushPayload(e.data)){de.debug("Received a valid encrypted push payload.");const t=e.data.json();return Promise.resolve([t])}return Promise.reject(`Unexpected push message payload received: ${e.data}`)}static isValidPushPayload(e){try{const t=e.json();return!!_t.isValid(t)||(de.debug("isValidPushPayload: Valid JSON but missing notification UUID:",t),!1)}catch(e){return de.debug("isValidPushPayload: Parsing to JSON failed with:",e),!1}}}"undefined"==typeof self&&void 0!==i.g?i.g.OneSignalWorker=jt:self.OneSignalWorker=jt,"undefined"!=typeof self&&jt.run(),self.OneSignal=jt})()})();
//# sourceMappingURL=OneSignalSDK.sw.js.map